<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CLEO Redux</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "rust" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="relation-to-cleo-library.html"><strong aria-hidden="true">1.1.</strong> Relation to CLEO Library</a></li></ol></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation-plugins.html"><strong aria-hidden="true">2.1.</strong> Plugins</a></li><li class="chapter-item expanded "><a href="installation-scripts.html"><strong aria-hidden="true">2.2.</strong> Scripts</a></li></ol></li><li class="chapter-item expanded "><a href="first-steps.html"><strong aria-hidden="true">3.</strong> First steps</a></li><li class="chapter-item expanded "><a href="config.html"><strong aria-hidden="true">4.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="permissions.html"><strong aria-hidden="true">4.1.</strong> Permissions</a></li></ol></li><li class="chapter-item expanded "><a href="scripts.html"><strong aria-hidden="true">5.</strong> Scripts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="compiled-scripts.html"><strong aria-hidden="true">5.1.</strong> Compiled Scripts (.cs)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="custom-commands.html"><strong aria-hidden="true">5.1.1.</strong> Custom Commands</a></li></ol></li><li class="chapter-item expanded "><a href="javascript.html"><strong aria-hidden="true">5.2.</strong> JavaScript</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="definitions.html"><strong aria-hidden="true">5.2.1.</strong> Definitions</a></li><li class="chapter-item expanded "><a href="script-lifecycle.html"><strong aria-hidden="true">5.2.2.</strong> Script Lifecycle</a></li><li class="chapter-item expanded "><a href="imports.html"><strong aria-hidden="true">5.2.3.</strong> Imports</a></li><li class="chapter-item expanded "><a href="async.html"><strong aria-hidden="true">5.2.4.</strong> Asynchronous Programming</a></li><li class="chapter-item expanded "><a href="events.html"><strong aria-hidden="true">5.2.5.</strong> Events</a></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">5.2.6.</strong> API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="fluent-interface.html"><strong aria-hidden="true">5.2.6.1.</strong> Fluent Interface</a></li><li class="chapter-item expanded "><a href="enums.html"><strong aria-hidden="true">5.2.6.2.</strong> Enums</a></li><li class="chapter-item expanded "><a href="script-object-vs-object.html"><strong aria-hidden="true">5.2.6.3.</strong> ScriptObject vs Object</a></li><li class="chapter-item expanded "><a href="using-math.html"><strong aria-hidden="true">5.2.6.4.</strong> Math Object</a></li><li class="chapter-item expanded "><a href="using-memory.html"><strong aria-hidden="true">5.2.6.5.</strong> Memory Object</a></li><li class="chapter-item expanded "><a href="using-memory-64.html"><strong aria-hidden="true">5.2.6.6.</strong> Memory Object (x64)</a></li><li class="chapter-item expanded "><a href="deprecated-bindings.html"><strong aria-hidden="true">5.2.6.7.</strong> Deprecated</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="typescript.html"><strong aria-hidden="true">5.3.</strong> TypeScript</a></li></ol></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">6.</strong> Troubleshooting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="log.html"><strong aria-hidden="true">6.1.</strong> Log</a></li><li class="chapter-item expanded "><a href="the-definitive-edition-faq.html"><strong aria-hidden="true">6.2.</strong> Support for The Definitive Edition</a></li></ol></li><li class="chapter-item expanded "><a href="other-features.html"><strong aria-hidden="true">7.</strong> Other Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="using-fxt.html"><strong aria-hidden="true">7.1.</strong> Custom Text (FXT)</a></li><li class="chapter-item expanded "><a href="unsupported.html"><strong aria-hidden="true">7.2.</strong> Unsupported Features</a></li><li class="chapter-item expanded "><a href="embedding.html"><strong aria-hidden="true">7.3.</strong> Embedding to custom host</a></li></ol></li><li class="chapter-item expanded "><a href="using-sdk.html"><strong aria-hidden="true">8.</strong> SDK</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cpp-sdk.html"><strong aria-hidden="true">8.1.</strong> C++ SDK</a></li><li class="chapter-item expanded "><a href="rust-sdk.html"><strong aria-hidden="true">8.2.</strong> Rust SDK</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CLEO Redux</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cleolibrary/CLEO-Redux" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>CLEO Redux is an <a href="./embedding.html">embeddable</a> and <a href="./using-sdk.html">extensible</a> runtime capable of running user-made scripts in games and desktop applications. It supports <a href="./javascript.html">JavaScript</a> and <a href="./typescript.html">TypeScript</a> languages. Inspired by <a href="https://cleo.li/">CLEO Library</a> and <a href="./relation-to-cleo-library.html">partially compatible</a> with its scripts and plugins, CLEO Redux, however, aims to provide better experience for developers and users and support games beyond just GTA 3D series.</p>
<p>Follow the <a href="./first-steps.html">first steps tutorial</a> to learn how to write and run your first script. Also check our <a href="https://www.youtube.com/playlist?list=PLNxQuEFtVkeizoLEQiok7qzr1f0mcwfFb">YouTube playlist</a> for video guides. Or jump straight away to <a href="https://github.com/cleolibrary/CLEO-Redux/tree/master/examples">example scripts</a>.</p>
<h2 id="supported-releases"><a class="header" href="#supported-releases">Supported Releases</a></h2>
<p>Grand Theft Auto series:</p>
<ul>
<li>GTA III 1.0</li>
<li>GTA Vice City 1.0</li>
<li>GTA San Andreas 1.0 (only with <a href="https://github.com/cleolibrary/CLEO4">CLEO 4.4</a>)</li>
<li>GTA IV The Complete Edition (1.2.0.43, 1.2.0.59)</li>
</ul>
<p>Grand Theft Auto: The Trilogy - The Definitive Edition:</p>
<ul>
<li>Title Update 1.03 and Title Update 1.04 (see <a href="./the-definitive-edition-faq.html">details</a>)</li>
</ul>
<p>Other games and applications:</p>
<ul>
<li>Bully: Scholarship Edition 1.200</li>
<li>re3 &amp; reVC (see <a href="./troubleshooting.html#cleo-does-not-work-with-re3-or-revc">details</a>)</li>
<li>unknown host (see <a href="./embedding.html">details</a>)</li>
</ul>
<p>For the complete reference on supported features <a href="https://github.com/cleolibrary/CLEO-Redux/wiki/Feature-Support-Matrix">refer to this page</a>. Also there are known limitations <a href="unsupported.html">listed here</a>.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>CLEO Redux is available under the <a href="https://re.cleo.li/LICENSE.txt">end-user license agreement</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="relation-to-cleo-library"><a class="header" href="#relation-to-cleo-library">Relation to CLEO Library</a></h1>
<p>CLEO is a common name for the custom libraries designed and created for GTA III, Vice City or San Andreas. Each version can be found and downloaded <a href="https://cleo.li/download.html">here</a>. CLEO Redux is <em>another</em> CLEO implementation made from scratch with a few distinctive features, such as shared code base between all games and JavaScript support.</p>
<p>At the moment CLEO Redux can not be considered as a complete replacement for CLEO Library due to the lack of support for many widely used CLEO commands. To solve this issue and get the best out of the two libraries, CLEO Redux supports two different usage strategies.</p>
<p>CLEO Redux can run as a standalone software, or as an addon to CLEO Library.</p>
<h2 id="running-cleo-redux-as-a-standalone-software"><a class="header" href="#running-cleo-redux-as-a-standalone-software">Running CLEO Redux as a standalone software</a></h2>
<p>As a standalone software CLEO Redux runs compiled scripts and JavaScript and provides access to all native script commands. It also provides a limited set of <a href="./custom-commands.html">custom commands</a> backward-compatible to CLEO Library. Existing CLEO scripts may not work if they use custom commands (for example from a third-party plugin) not supported by CLEO Redux.</p>
<p>In the standalone mode your game directory contains <code>cleo_redux.asi</code> (or <code>cleo_redux64.asi</code>) file and there is no <code>cleo.asi</code> (or <code>III.CLEO.asi</code> or <code>VC.CLEO.asi</code>) file from CLEO Library. This mode does not work in the classic GTA San Andreas.</p>
<h2 id="running-cleo-redux-as-an-addon-to-cleo-library"><a class="header" href="#running-cleo-redux-as-an-addon-to-cleo-library">Running CLEO Redux as an addon to CLEO library</a></h2>
<p>As an addon CLEO Redux runs alongside CLEO Library delegating it all the care for custom scripts. It means all custom scripts and plugins made for CLEO Library will continue working exactly the same. CLEO Redux only manages JS scripts. All custom commands become available to JavaScript runtime, which means you can use commands currently not implemented natively in CLEO Redux, for example for <a href="https://library.sannybuilder.com/#/gta3/classes/File">files</a>.</p>
<p>In the delegate mode your game directory contains both <code>cleo.asi</code> (or <code>III.CLEO.asi</code> or <code>VC.CLEO.asi</code>) from CLEO Library and <code>cleo_redux.asi</code> (or <code>cleo_redux64.asi</code>). This mode works in classic GTA III, GTA Vice City and GTA San Andreas where CLEO Library exists.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<ul>
<li><a href="installation.html#cleo-directory">CLEO Directory</a></li>
<li><a href="installation.html#dependency-on-asi-loader">Dependency on ASI Loader</a></li>
<li><a href="installation.html#note-on-re3-or-revc">Note on re3 or reVC</a></li>
<li><a href="installation.html#uninstallation">Uninstallation</a></li>
</ul>
<p>CLEO Redux comes with a hassle-free installer that identifies the selected game and downloads all the dependencies. Just run <code>cleo_redux_setup.exe</code> and follow its steps.</p>
<blockquote>
<p>Both CLEO Redux and its installer recognize the target game purely by the executable name in the selected/working directory.</p>
<ul>
<li>GTA III - <code>gta3.exe</code></li>
<li>GTA VC - <code>gta-vc.exe</code></li>
<li>GTA SA - <code>gta_sa.exe</code>, <code>gta-sa.exe</code>, or <code>gta_sa_compact.exe</code></li>
<li>GTA IV - <code>GTAIV.exe</code></li>
<li>re3 - <code>re3.exe</code></li>
<li>reVC - <code>reVC.exe</code></li>
<li>GTA III: DE - <code>libertycity.exe</code></li>
<li>GTA VC: DE - <code>vicecity.exe</code></li>
<li>GTA SA: DE - <code>sanandreas.exe</code></li>
<li>Bully: SE - <code>bully.exe</code></li>
</ul>
<p>Names matching is case-insensitive. If the exe file does not contain a version information CLEO Redux always assumes the version is correct (see <a href="./introduction.html#supported-releases">supported versions</a>).</p>
</blockquote>
<p>Once the installation is complete, CLEO Redux is ready to use. You can now <a href="./installation-scripts.html">install scripts</a> and <a href="./installation-plugins.html">extra plugins</a> not included in the installer, and change the <a href="./config.html">default configuration</a> if needed.</p>
<h2 id="cleo-directory"><a class="header" href="#cleo-directory">CLEO Directory</a></h2>
<p>CLEO directory is the primary location where you install <a href="./installation-scripts.html">CLEO scripts</a>, <a href="./installation-plugins.html">CLEO plugins</a> and <a href="./using-fxt.html">custom texts</a>. CLEO Redux automatically creates this folder during installation and any time the game starts.</p>
<p>In most cases this directory can be found in the game folder. If, however, CLEO lacks write permissions there and fails to create new files, it uses an alternate path at <code>C:\Users\&lt;your_username&gt;\AppData\Roaming\CLEO Redux</code>. <code>cleo_redux.log</code> and the <code>CLEO</code> directory can be found there.</p>
<h2 id="dependency-on-asi-loader"><a class="header" href="#dependency-on-asi-loader">Dependency on ASI Loader</a></h2>
<p>CLEO Redux is distributed as a dynamic-load library with an <code>.asi</code> extension. Historically ASI files have been used in GTA III and Vice City as addons to the Miles Sound System library (Mss32) which loads them into the game process. More recent titles didn't use MSS, so the modding community developed custom loaders commonly named &quot;ASI Loader&quot; to continue using ASI for any custom code to be injected into the game.</p>
<p><a href="https://github.com/ThirteenAG/Ultimate-ASI-Loader/releases">Ultimate ASI Loader</a> by ThirteenAG can be used to load CLEO Redux in any game. It gets downloaded during CLEO Redux setup. You may opt out of installing Ultimate ASI Loader if you have other means of injecting ASI files into the game (i.e. an alternative loader) or the game already supports ASI, e.g. by using MSS lib.</p>
<p>Note that the Ultimate ASI Loader dll file can be renamed, e.g. to <code>dinput8.dll</code> or <code>d3d9.dll</code> depending on the game. By default CLEO Redux installs it as <code>vorbisFile.dll</code> in 32-bit games and <code>version.dll</code> in 64-bit games. There are some exceptions:</p>
<ul>
<li>it is <code>d3d9.dll</code> in re3 and reVC (x64)</li>
<li>it is <code>dinput8.dll</code> in GTA IV</li>
</ul>
<p>If the default name does not work with the given game, try renaming the dll file into another compatible name. Visit <a href="https://github.com/ThirteenAG/Ultimate-ASI-Loader">Ultimate ASI loader repo</a> for more information.</p>
<h2 id="note-on-re3-or-revc"><a class="header" href="#note-on-re3-or-revc">Note on re3 or reVC</a></h2>
<p>CLEO Redux supports &quot;Windows D3D9&quot; version of <code>re3</code> or <code>reVC</code> (both 32-bit and 64-bit).</p>
<p>During installation you must select the correct version of <code>re3</code> or <code>reVC</code>: either 32-bit or 64-bit.</p>
<p>When running on <code>re3</code> and <code>reVC</code> make sure the game directory contains the file <code>re3.pdb</code> (for <strong>re3</strong>) or <code>reVC.pdb</code> (for <strong>reVC</strong>). Due to the dynamic nature of memory addresses in those implementations CLEO Redux relies on debug information stored in the PDB file to correctly locate itself.</p>
<h2 id="uninstallation"><a class="header" href="#uninstallation">Uninstallation</a></h2>
<p>To uninstall CLEO Redux perform the following steps:</p>
<ul>
<li>Delete <code>cleo_redux.asi</code> (or <code>cleo_redux64.asi</code>).</li>
<li>Delete the <code>CLEO</code> folder (optional).</li>
<li>Delete the <code>cleo_redux.log</code> (optional)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plugins"><a class="header" href="#plugins">Plugins</a></h1>
<p>Plugins are optional programs adding extra scripting commands with the help of <a href="./using-sdk.html">CLEO Redux SDK</a>. A plugin file has a <code>.cleo</code> extension and should be copied to the <code>CLEO\CLEO_PLUGINS</code> directory.</p>
<h2 id="list-of-plugins"><a class="header" href="#list-of-plugins">List of plugins</a></h2>
<table><thead><tr><th>Name</th><th>Description</th><th>Link</th></tr></thead><tbody>
<tr><td><a href="https://library.sannybuilder.com/#/unknown_x86/ini">IniFiles</a></td><td>Reading from and writing to INI files</td><td><a href="https://github.com/cleolibrary/CLEO-Redux/tree/master/plugins/IniFiles">src</a></td></tr>
<tr><td><a href="https://library.sannybuilder.com/#/unknown_x86/dylib">Dylib</a></td><td>Loading DLL files and importing functions</td><td><a href="https://github.com/cleolibrary/CLEO-Redux/tree/master/plugins/Dylib">src</a></td></tr>
<tr><td><a href="https://library.sannybuilder.com/#/unknown_x86/input">Input</a></td><td>Checking for keyboard and mouse input, emulating key presses</td><td><a href="https://github.com/cleolibrary/CLEO-Redux/tree/master/plugins/Input">src</a></td></tr>
<tr><td><a href="https://library.sannybuilder.com/#/unknown_x86/imgui">ImGuiRedux</a></td><td>Dear ImGui bindings</td><td><a href="https://github.com/user-grinch/ImGuiRedux">GitHub repo</a></td></tr>
<tr><td><a href="https://library.sannybuilder.com/#/unknown_x86/memops">MemoryOperations</a></td><td>Low-level memory operations</td><td><a href="https://github.com/cleolibrary/CLEO-REDUX-PLUGINS">GitHub repo</a></td></tr>
<tr><td>Frontend</td><td>Checking for updates on GitHub and displaying information in the main menu</td><td></td></tr>
<tr><td>Events</td><td>Emitting <a href="./events.html">custom events</a></td><td><a href="https://github.com/cleolibrary/CLEO-Redux/tree/master/plugins/Events">src</a></td></tr>
</tbody></table>
<p>Plugins are included in the CLEO Redux installer. You can opt out of some of them by unchecking the corresponding checkbox in the installer.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scripts"><a class="header" href="#scripts">Scripts</a></h1>
<h2 id="adding-a-new-script"><a class="header" href="#adding-a-new-script">Adding a new script</a></h2>
<p>Generally a script file (<code>.cs</code>, <code>.js</code>) should just be copied to the <code>CLEO</code> directory. Some scripts may require extra steps for installation. In case of any issues check the script documentation or ask its author.</p>
<p><a href="./script-lifecycle.html#organizing-scripts">Complex JS scripts</a> with dependencies may be distributed as folders with <code>index.js</code> and other files in it. Copy such folders to the <code>CLEO</code> directory.</p>
<h2 id="removing-the-script"><a class="header" href="#removing-the-script">Removing the script</a></h2>
<p>Delete the script file from <code>CLEO</code> directory. Some scripts may require extra steps for undoing the installation. In case of any issues check the script documentation or ask its author.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="first-steps"><a class="header" href="#first-steps">First steps</a></h1>
<ul>
<li><a href="first-steps.html#introduction">Introduction</a></li>
<li><a href="first-steps.html#concurrency">Concurrency</a></li>
<li><a href="first-steps.html#variables">Variables</a></li>
<li><a href="first-steps.html#control-flow">Control Flow</a>
<ul>
<li><a href="first-steps.html#conditions">Conditions</a></li>
<li><a href="first-steps.html#loops">Loops</a></li>
</ul>
</li>
<li><a href="first-steps.html#functions">Functions</a></li>
</ul>
<h2 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h2>
<p>Since <a href="./api.html">available commands</a> vary from game to game for the purpose of this tutorial we will be using CLEO's built-in commands such as <a href="./log.html"><code>log</code></a> command that is available everywhere.</p>
<p>Once you have CLEO Redux <a href="./installation.html">installed</a> run the game once to make sure CLEO is loading. You can verify it by having <code>cleo_redux.log</code> created in the game root folder. If there are no errors in the log you can start adding new scripts.</p>
<p>Go to the <a href="./cleo-directory.html">CLEO directory</a> and create a new file named <code>intro.js</code>. This will be a text file and you can edit it in any text editor. We recommend using VS Code as the most advanced choice available today, but other editors, even Notepad, would work too. Open <code>intro.js</code> and add two lines:</p>
<pre><code class="language-js">// intro script, revision 1
log(&quot;Hello world&quot;);
</code></pre>
<p>Lines starting with <code>//</code> are comments and ignored by the game. The only meaningful line is the second that instructs the JavaScript runtime to print a message in the log file.</p>
<p>Now save the file and run the game. Start a new game or load a save file, play a few seconds and then go to <code>cleo_redux.log</code> (do not exit the game yet). You should now see a new line like:</p>
<pre><code class="language-log">10:12:19 [INFO] [&quot;intro&quot;] &quot;Hello world&quot;
</code></pre>
<p>If you can't find this line, try to read through other messages, they might point you out the issue.</p>
<p>If you see the message, open <code>intro.js</code> again and change &quot;Hello world&quot; to another text. Save the file and go back to game. Play, then switch back to <code>cleo_redux.log</code>. Notice how the log now contains the new message. The script was reloaded on the fly as you saved it and the game now runs an updated version of it. This is called <a href="./other-features.html#hot-reload">hot reloading</a>.</p>
<h2 id="concurrency"><a class="header" href="#concurrency">Concurrency</a></h2>
<p>There is so little fun in a single script, so let's explore another important aspect. CLEO Redux can load and run many scripts concurrently. But they do not run in parallel, or at the same time. Instead there is a queue of scripts to execute them sequentually on each game loop iteration. It reduces a number of possible issues caused due to the use of shared resources from multiple parallel scripts. The game's main loop is also locked while CLEO scripts get processed.</p>
<p>When the script is ready to return control to the main script or another script in the queue, it must call the <code>wait(n)</code> command where <code>n</code> is a number greater than or equal to zero. This command pauses the current script for at least <code>n</code> milliseconds:</p>
<pre><code class="language-js">wait(250); // pause current script and wake up after 250 milliseconds
</code></pre>
<p>Low values (such as <code>0</code> or generally anything lower than <code>16</code>) essentially make the script run on each tick of the game's main loop.</p>
<p>Let's create another JS file in the CLEO directory and call it <code>second.js</code>. Add the following lines:</p>
<pre><code class="language-js">wait(1000);
log(&quot;This is the second script&quot;);
</code></pre>
<p>Save the file and re-run the game. You should now see two lines in the <code>cleo_redux.log</code>:</p>
<pre><code class="language-log">10:12:19 [INFO] [&quot;intro&quot;] &quot;Hello world&quot;
10:12:20 [INFO] [&quot;second&quot;] &quot;This is the second script&quot;
</code></pre>
<p>Notice that there is a difference in one second between two messages. Try different combinations of <code>log</code> and <code>wait</code> commands in both scripts and see the results. Do they match your expectations?</p>
<h2 id="variables"><a class="header" href="#variables">Variables</a></h2>
<p>Variables keep your script's state and intermediate results. Each variable has a unique name and a type and can be either mutable or immutable. Mutable variables are created with <code>var</code> or <code>let</code> keywords. Immutable variables (or constants) are created with a <code>const</code> keyword.</p>
<pre><code class="language-js">let x = 5;
let name = &quot;CJ&quot;;
const z = -100;
</code></pre>
<p>Constants can not be reassigned to another value. The following code will throw an error:</p>
<pre><code class="language-js">const z = -100;
z = -200;
</code></pre>
<p>On the other side <code>var</code> or <code>let</code> variables can get new values. Those values can be of a different type, e.g. you can reuse same variable for different types of data:</p>
<pre><code class="language-js">let temp;

temp = 1; // number
temp = &quot;str&quot;; // string
temp = {}; // object
temp = []; // array
</code></pre>
<p>Use operator <code>typeof</code> to find the type of the variable at any given moment:</p>
<pre><code class="language-js">let temp;

temp = 1;
log(typeof temp); // prints &quot;number&quot; in cleo_redux.log
temp = &quot;str&quot;;
log(typeof temp); // prints &quot;string&quot; in cleo_redux.log
temp = {};
log(typeof temp); // prints &quot;object&quot; in cleo_redux.log
temp = [];
log(typeof temp); // prints &quot;object&quot; in cleo_redux.log*
</code></pre>
<blockquote>
<p>*<code>typeof</code> returns &quot;object&quot; for an array (<code>[]</code>). This is a very well known quirk in the language. You can <a href="https://web.mit.edu/jwalden/www/isArray.html">read more about it here</a> and find other means of differenting between arrays and plain objects.</p>
</blockquote>
<h2 id="control-flow"><a class="header" href="#control-flow">Control Flow</a></h2>
<h3 id="conditions"><a class="header" href="#conditions">Conditions</a></h3>
<p>So far we have been running commands in the script in a sequence from top to bottom. The runtime executed the first line, then proceed to the second line if there was one, then to the third line, etc. But what if we want to execute a command only when some condition is met, lets say a button is pressed? We can use conditions.</p>
<p>In JavaScript an <code>if</code> statement allows to conditionally execute a branch of code if the condition is met. For example, when you write:</p>
<pre><code class="language-js">if (true) {
  log(&quot;this is always printed&quot;);
}
</code></pre>
<p>You always get the log line printed since the condition in <code>if</code> always evaluates to true. Likewise</p>
<pre><code class="language-js">if (false) {
  log(&quot;this will never be printed&quot;);
}
</code></pre>
<p>when the condition evaluates to <code>false</code> inside the if block does not run so you won't see the log messages.</p>
<p>You can have any expression in the <code>if</code> statement. JavaScript runtime will try its best to convert it to a boolean (simply saying, convert to <code>true</code> or <code>false</code>). Here are some examples of expressions that get evaluated to <code>true</code> (they are called <code>truthy</code>):</p>
<pre><code class="language-js">if (1) {...}
if (&quot;string&quot;) {...}
if (5 &gt; 4) {...}
if ([]) {...}
if ({}) {...}
</code></pre>
<p>Note that 0 and an empty string always get evaluated to false (they are &quot;falsy&quot; values):</p>
<pre><code class="language-js">if (0) {...}
if (&quot;&quot;) {...}
</code></pre>
<p>Of course you can have complex experession like functions or methods calls inside the if condition:</p>
<pre><code class="language-js">if (&quot;string&quot;.length &gt; 0) {...}
if ([1,2,3].includes(3)) {...}
if ( ({ status: 'open'}).status === 'open' ) {...}
</code></pre>
<p>CLEO API has many conditional commands for different types of checks. For example, the <code>Input</code> plugin provides commands to check the user input (i.g. a check that the button is pressed). Go to <code>intro.js</code> and change its content to:</p>
<pre><code class="language-js">// intro script, revision 2
wait(2000);
if (native(&quot;IS_KEY_PRESSED&quot;, 115)) {
  log(&quot;F4 button is pressed&quot;);
}
</code></pre>
<p>Run the game. In <code>cleo_redux.log</code> you should not see the line &quot;F4 button is pressed&quot;. Now try running it while holding the <code>F4</code> button. A new log entry should appear.</p>
<p>You can combine multiple conditions in the same if statement using <code>&amp;&amp;</code> (AND) or <code>||</code> (or) operators :</p>
<pre><code class="language-js">if (native(&quot;IS_KEY_PRESSED&quot;, 115) || native(&quot;IS_KEY_PRESSED&quot;, 116)) {
  log(&quot;Either F4 or F5 button is pressed&quot;);
}
</code></pre>
<pre><code class="language-js">if (native(&quot;IS_KEY_PRESSED&quot;, 115) &amp;&amp; native(&quot;IS_KEY_PRESSED&quot;, 116)) {
  log(&quot;Both F4 and F5 button are pressed&quot;);
}
</code></pre>
<p>You can execute commands in <code>else</code> block if the condition is not met:</p>
<pre><code class="language-js">if (native(&quot;IS_KEY_PRESSED&quot;, 115)) {
  log(&quot;F4 button is pressed&quot;);
} else {
  log(&quot;F4 button is not pressed&quot;);
}
</code></pre>
<h3 id="loops"><a class="header" href="#loops">Loops</a></h3>
<p>TBD</p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<p>TBD</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>CLEO Redux exposes some of the configurable settings in the file <code>CLEO\.config\cleo.ini</code>.</p>
<h2 id="general"><a class="header" href="#general">General</a></h2>
<ul>
<li>
<p><code>AllowCs</code> - when set to <code>1</code> CLEO loads and executes <code>*.cs</code> files located in the <a href="./cleo-directory.html">CLEO directory</a>. Enabled by default.</p>
</li>
<li>
<p><code>AllowJs</code> - when set to <code>1</code> CLEO loads and executes <code>*.js</code> files located in the <a href="./cleo-directory.html">CLEO directory</a>. Enabled by default.</p>
</li>
<li>
<p><code>AllowFxt</code> - when set to <code>1</code> CLEO loads and <a href="./using-fxt.html">uses</a> <code>*.fxt</code> files located in the CLEO\CLEO_TEXT directory. Enabled by default.</p>
</li>
<li>
<p><code>LogOpcodes</code> - when set to <code>1</code> CLEO <a href="./log.html">logs</a> all executed opcodes in custom scripts.</p>
</li>
<li>
<p><code>PermissionLevel</code> - sets the <a href="./permissions.html">permission level</a> for unsafe operations (see below). Default is <code>Lax</code>.</p>
</li>
<li>
<p><code>CheckUpdates</code> - (deprecated in favor of <a href="./installation-plugins.html">Frontend</a> plugin)</p>
</li>
<li>
<p><code>DisplayMenuInfo</code> - (deprecated in favor of <a href="./installation-plugins.html">Frontend</a> plugin)</p>
</li>
</ul>
<h2 id="host"><a class="header" href="#host">Host</a></h2>
<ul>
<li><code>EnableSelfHost</code> - when set to <code>1</code> CLEO runs in the self-host mode. Only applicable on an Unknown host. See the <a href="./embedding.html">Emdedding</a> guide for more information.</li>
<li><code>SelfHostFps</code> - the amount of iterations per second the CLEO's main loop will do. Only applicable when <code>EnableSelfHost</code> is <code>1</code>. Default is <code>30</code>.</li>
</ul>
<h2 id="permissions"><a class="header" href="#permissions">Permissions</a></h2>
<p>This section lists permission tokens and sets whether they are allowed or not in the <a href="./permissions.html#strict">Strict mode</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="permissions-1"><a class="header" href="#permissions-1">Permissions</a></h1>
<p>CLEO Redux acknowledges some <a href="./custom-commands.html">custom commands</a> (opcodes) as unsafe and requires the user to decide whether to run them or not. Raw access to the process memory, loading external libraries or making network requests can be harmful and produce undesired side-effects. Hence CLEO introduces permission levels for running the unsafe code.</p>
<p>There are four available levels:</p>
<h3 id="all"><a class="header" href="#all">All</a></h3>
<p>Any unsafe operation is allowed. Use this only when you trust the scripts you run.</p>
<h3 id="lax"><a class="header" href="#lax">Lax</a></h3>
<p>This is the default permission level.</p>
<p>No unsafe operation is allowed unless the script explicitly requests it. Currently to request a permission, the name of the script file must include the permissions tokens wrapped in square brackets.</p>
<p>For example, if the script wants to access the memory via <code>0A8D READ_MEMORY</code> the file name must contain <code>[mem]</code>, e.g. <code>cool-spawner[mem].cs</code>. If the file is named differently CLEO rejects <code>0A8D</code> and the script crashes.</p>
<h3 id="strict"><a class="header" href="#strict">Strict</a></h3>
<p>No unsafe operation is allowed unless the script explicitly requests it (see <code>&quot;Lax&quot;</code>) and the CLEO config file permits this type of operation under the <code>Permissions</code> section.</p>
<p>Permissions section in <code>cleo.ini</code> allows to enable or disable groups of unsafe operations by using the <a href="permissions.html#known-permission-tokens">permission tokens</a>. For example,</p>
<pre><code class="language-ini">mem=0
</code></pre>
<p>disables all memory-related opcodes even if the script has the <code>[mem]</code> token in the file name.</p>
<blockquote>
<p><code>Permissions</code> section in the <code>cleo.ini</code> only takes effect when <code>PermissionLevel</code> is <code>Strict</code>.</p>
</blockquote>
<h3 id="none"><a class="header" href="#none">None</a></h3>
<p>No unsafe operation is allowed.</p>
<h2 id="known-permission-tokens"><a class="header" href="#known-permission-tokens">Known Permission Tokens</a></h2>
<ul>
<li><code>mem</code> - reading from and writing to the process memory, calling foreign functions </li>
<li><code>dll</code> - loading dynamic libraries and finding exported functions</li>
<li><code>fs</code> - creating, reading and deleting files from the local file system</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scripts-1"><a class="header" href="#scripts-1">Scripts</a></h1>
<p>CLEO Redux provides a runtime capable of executing <a href="./compiled-scripts.html">compiled binary scripts</a> (<code>*.cs</code>) in the native SCM format and plain text scripts (<code>*.js</code>) written in <a href="./javascript.html">JavaScript</a>.</p>
<p>To find the information on how to install scripts <a href="./installation-scripts.html">see this page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compiled-scripts"><a class="header" href="#compiled-scripts">Compiled Scripts</a></h1>
<p>Older games in Grand Theft Auto 3D series (GTA III, Vice City, San Andreas) use a custom binary format to store compiled scripts. This format is known as <a href="https://gtamods.com/wiki/SCM_Instruction">SCM</a>. CLEO Library and CLEO Redux uses the same format for custom scripts. They usually have a <code>.cs</code> extension.</p>
<p>CS scripts run alongside the original SCM scripts and are subject to the <a href="https://docs.sannybuilder.com/scm-documentation/gta-limits">same limitations</a>.</p>
<p><a href="the-definitive-edition-faq.html#how-do-i-compile-cleo-scripts-with-sanny-builder">Check the FAQ</a> for the information on CS support in the remastered games.</p>
<h2 id="writing-a-compiled-script"><a class="header" href="#writing-a-compiled-script">Writing a Compiled Script</a></h2>
<blockquote>
<p>For a detailed step-by-step tutorial <a href="https://gtamods.com/wiki/CLEO/Tutorial">visit this page</a>. It's applicable to CLEO Redux.</p>
</blockquote>
<p>To create a new script use <a href="https://sannybuilder.com">Sanny Builder 3</a> in GTA III, GTA VC or GTA SA edit modes respectively. Add a directive <code>{$CLEO .cs}</code> at the top of your script, write the code and run &quot;Compile and Copy&quot;. Sanny Builder will create a new CS file in the CLEO directory. </p>
<p>At the moment CLEO Redux only provides a few custom commands. Most of the commands implemented in CLEO Library or its plugins are not available yet.</p>
<p>There are a few basic rules to follow when writing compiled scripts:</p>
<ol>
<li>
<p>One file - one script. CLEO only supports one script per file.</p>
</li>
<li>
<p>Never use opcode <code>004E</code> to terminate a script. This opcode is only supported in the <code>main.scm</code>. Use <a href="https://library.sannybuilder.com/#/sa/CLEO/0A93?p=1&amp;v=1">0A93</a> instead.</p>
</li>
<li>
<p>Minimize the usage of global variables as they might conflict with other scripts. Some well-known variables such <code>$PLAYER_CHAR</code>, <code>$PLAYER_ACTOR</code> and <code>$ONMISSION</code> can be used.</p>
</li>
</ol>
<p>CLEO Redux does not support saving the script status (a feature of CLEO Library) and there are no plans on adding this feature.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-commands"><a class="header" href="#custom-commands">Custom Commands</a></h1>
<blockquote>
<p>The following commands are for classic GTA games only. For GTA The Trilogy <a href="the-definitive-edition-faq.html#can-i-use-cleo-opcodes">check this information</a>.</p>
</blockquote>
<p>CLEO Redux supports all original opcodes available in the given game. On top of those it adds a few new commands listed below. Note that they strictly match the opcodes of CLEO Library.</p>
<ul>
<li>0A8C <a href="https://library.sannybuilder.com/#/gta3/CLEO/0A8C">WRITE_MEMORY</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
<li>0A8D <a href="https://library.sannybuilder.com/#/gta3/CLEO/0A8D">READ_MEMORY</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
<li>0A8E <a href="https://library.sannybuilder.com/#/gta3/CLEO/0A8E">INT_ADD</a></li>
<li>0A8F <a href="https://library.sannybuilder.com/#/gta3/CLEO/0A8F">INT_SUB</a></li>
<li>0A90 <a href="https://library.sannybuilder.com/#/gta3/CLEO/0A90">INT_MUL</a></li>
<li>0A91 <a href="https://library.sannybuilder.com/#/gta3/CLEO/0A91">INT_DIV</a></li>
<li>0A93 <a href="https://library.sannybuilder.com/#/gta3/CLEO/0A93">TERMINATE_THIS_CUSTOM_SCRIPT</a></li>
<li>0AA5 <a href="https://library.sannybuilder.com/#/gta3/CLEO/0AA5">CALL_FUNCTION</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
<li>0AA6 <a href="https://library.sannybuilder.com/#/gta3/CLEO/0AA6">CALL_FUNCTION_RETURN</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
<li>0AA7 <a href="https://library.sannybuilder.com/#/gta3/CLEO/0AA7">CALL_METHOD</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
<li>0AA8 <a href="https://library.sannybuilder.com/#/gta3/CLEO/0AA8">CALL_METHOD_RETURN</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
<li>0AB0 <a href="https://library.sannybuilder.com/#/gta3/CLEO/0AB0">IS_KEY_PRESSED</a></li>
</ul>
<p>This list might not be complete as there are <a href="./using-sdk.html">custom plugins with extra commands</a>. Refer to <a href="https://library.sannybuilder.com">Sanny Builder Library</a> for the complete list of available commands for each game.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="javascript"><a class="header" href="#javascript">JavaScript</a></h1>
<p>CLEO Redux targets JavaScript as the primary language for custom scripts. JavaScript is a popular programming language with rich ecosystem and plenty of available information. It's free from SCM language limits and pitfalls such as lack of support for functions, arrays, or the low number of variables.</p>
<p>To make a JS script use VS Code (recommended) or any editor of your choice. Create a new file with <code>.js</code> extension and put it in the CLEO folder. See <a href="./script-lifecycle.html">Script lifecycle</a> for extra information.</p>
<p>The runtime supports <a href="https://262.ecma-international.org/11.0/">ECMAScript 2020 standard</a>. It means you are able to use the most recent JavaScript features out of the box, such as imports, classes, arrow functions, etc.</p>
<blockquote>
<p>CLEO Redux is not Node.js. Don't expect sockets, file system operations or other Node.js features to be available here.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="definitions"><a class="header" href="#definitions">Definitions</a></h1>
<p>Due to the dynamic nature of JavaScript CLEO Redux needs to know an interface of each native command, i.e. a number of input arguments and returned values and their types. <a href="https://library.sannybuilder.com">Sanny Builder Library</a> serves as the source of command definitions for CLEO Redux.</p>
<p>At start CLEO validates that a definition file is present and correct and if not tries to download it from GitHub (see the table below) into your local <code>CLEO/.config</code> directory. If that did not happen, or you don't want to let CLEO make network calls, manually download the required file and place it in the <code>CLEO/.config</code> directory.</p>
<table><thead><tr><th>Game</th><th>File</th><th>Minimum Required Version</th></tr></thead><tbody>
<tr><td>GTA III, re3</td><td><a href="https://github.com/sannybuilder/library/blob/master/gta3/gta3.json">gta3.json</a></td><td><code>0.354</code></td></tr>
<tr><td>GTA VC, reVC</td><td><a href="https://github.com/sannybuilder/library/blob/master/vc/vc.json">vc.json</a></td><td><code>0.364</code></td></tr>
<tr><td>GTA San Andreas (Classic) 1.0</td><td><a href="https://github.com/sannybuilder/library/blob/master/sa/sa.json">sa.json</a></td><td><code>0.795</code></td></tr>
<tr><td>GTA III: The Definitive Edition</td><td><a href="https://github.com/sannybuilder/library/blob/master/gta3_unreal/gta3_unreal.json">gta3_unreal.json</a></td><td><code>0.284</code></td></tr>
<tr><td>Vice City: The Definitive Edition</td><td><a href="https://github.com/sannybuilder/library/blob/master/vc_unreal/vc_unreal.json">vc_unreal.json</a></td><td><code>0.293</code></td></tr>
<tr><td>San Andreas: The Definitive Edition</td><td><a href="https://github.com/sannybuilder/library/blob/master/sa_unreal/sa_unreal.json">sa_unreal.json</a></td><td><code>0.401</code></td></tr>
<tr><td>GTA IV</td><td><a href="https://github.com/sannybuilder/library/blob/master/gta_iv/gta_iv.json">gta_iv.json</a></td><td><code>0.88</code></td></tr>
<tr><td>Unknown (32-bit)</td><td><a href="https://github.com/sannybuilder/library/blob/master/unknown_x86/unknown_x86.json">unknown_x86.json</a></td><td><code>0.236</code></td></tr>
<tr><td>Unknown (64-bit)</td><td><a href="https://github.com/sannybuilder/library/blob/master/unknown_x64/unknown_x64.json">unknown_x64.json</a></td><td><code>0.239</code></td></tr>
<tr><td>Bully: Scholarship Edition</td><td><a href="https://github.com/sannybuilder/library/blob/master/bully/bully.json">bully.json</a></td><td><code>0.84</code></td></tr>
</tbody></table>
<p>CLEO Redux uses compound definitions (a combination of the primary JSON file for the current game and a JSON file for the Unknown host). It lets SDK commands to work in JS scripts regardless of them being defined or not in the primary JSON file. You should notice that during updates CLEO downloads both <code>&lt;game&gt;.json</code> and <code>unknown.json</code> as well as the accompanying <code>enums.js</code> files. It should not affect any existing scripts.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="script-lifecycle"><a class="header" href="#script-lifecycle">Script Lifecycle</a></h1>
<p>A file with the JavaScript code should have a <code>.js</code> extension and contain valid instructions. </p>
<p>Valid instructions include a code conforming to the ECMAScript 2020 standard and custom bindings available in the CLEO Redux runtime. If the runtime encounters an unknown or <a href="./permissions.html">illegal</a> instruction the execution halts and a new error is <a href="./log.html">logged</a> in <code>cleo_redux.log</code>. The script may have no instructions (the empty script). </p>
<p>CLEO script runs as soon as the new game starts or a save file is loaded. If you change the file while the game is running, CLEO <a href="./other-features.html#hot-reload">reloads</a> the script and it restarts.</p>
<p>The script terminates automatically when the last instruction has been executed. The runtime also terminates stuck scripts to prevent the game from freezing. The stuck script is the one that took more than <code>2</code> seconds to run since the last wait command. If that happened, check out your loops, some of the are missing the wait command.</p>
<pre><code class="language-js">while (true) {
  // meaningless infinite loop normally freezing the game
  // will be terminated after two seconds
}
</code></pre>
<p>The runtime will terminate this script. To avoid that, add the wait command</p>
<pre><code class="language-js">while (true) {
  wait(250);
  // still meaningless, but does not freeze the game
}
</code></pre>
<h2 id="organizing-scripts"><a class="header" href="#organizing-scripts">Organizing Scripts</a></h2>
<p>A single self-contained script file can be placed directly in the <a href="./cleo-directory.html">CLEO directory</a>. </p>
<p>Complex JS scripts having a lot of dependencies (imported files, <a href="./using-fxt.html">FXT</a> dictionaries) can be organized in folders. CLEO Redux scans the subdirectories of the <a href="./cleo-directory.html">CLEO directory</a> and checks if there is a file named <code>index.js</code>. If <code>index.js</code> is found, CLEO Redux runs it. It also loads all FXT files from the same directory. </p>
<p>Let's have a look at the example structure: </p>
<pre><code>CLEO/
├─ CLEO_TEXT/
│  ├─ main.fxt
├─ folderA/
│  ├─ text.fxt
│  ├─ index.js
├─ folderB/
│  ├─ test.fxt
│  ├─ test.js
├─ script1.js
├─ script2.cs
</code></pre>
<p>By default CLEO Redux loads all CS and JS files from the root of the CLEO directory and FXT files from the <code>CLEO_TEXT</code> folder. So it loads <code>script1.js</code>, <code>script2.cs</code>, and <code>main.fxt</code>. </p>
<p>After scanning subdirectories, CLEO loads <code>index.js</code> and <code>text.fxt</code> located in the <code>folderA</code> and skips <code>folderB</code> as there is no <code>index.js</code> file.</p>
<blockquote>
<p>CLEO_TEXT, CLEO_PLUGINS, and .config are not considered as script directories.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="imports"><a class="header" href="#imports">Imports</a></h1>
<p>You can import other scripts and some custom file formats in your code to make the code modular and share the common logic. This page describes static <code>import</code> statements (unconditional importing). Their format matches the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">ES6 import syntax</a>. CLEO Redux also supports <a href="./async.html#dynamic-imports">dynamic imports</a> (importing on-demand).</p>
<ul>
<li><a href="imports.html#importing-scripts">Importing scripts</a></li>
<li><a href="imports.html#importing-json-files">Importing JSON files</a></li>
<li><a href="imports.html#importing-other-formats">Importing other formats</a>
<ul>
<li><a href="imports.html#txt">TXT</a></li>
<li><a href="imports.html#ide">IDE</a></li>
</ul>
</li>
</ul>
<h2 id="importing-scripts"><a class="header" href="#importing-scripts">Importing scripts</a></h2>
<ul>
<li>Extensions: <code>.js</code>, <code>.mjs</code>, <code>.ts</code></li>
</ul>
<p><code>./</code> in a path resolves to the current file's directory. If a script is located at <code>C:\Game\CLEO\mod1\extra\addon.js</code> and it contains <code>import { foo } from './bar.js'</code>, the runtime will try to load <code>C:\Game\CLEO\mod1\extra\bar.js</code>.</p>
<p><code>../</code> resolves to the parent directory. If a script is located at <code>C:\Game\CLEO\mod1\extra\addon.js</code> and it contains <code>import { foo } from '../bar.js'</code>, the runtime will try to load <code>C:\Game\CLEO\mod1\bar.js</code>. You can combine <code>../</code> to traverse multiple levels up.</p>
<p>To avoid running imported <code>.js</code> files as standalone scripts, either put them into a separate folder outside of the main <a href="./cleo-directory.html">CLEO directory</a> (e.g. <code>CLEO/includes/</code>) or use the extension <code>.mjs</code>.</p>
<pre><code class="language-js">// imports default export from other.js or other.mjs located in the same directory
import func from &quot;./other&quot;;

// imports named export PedType from types.js or types.mjs located in the CLEO/includes directory
import { PedType } from &quot;./includes/types&quot;;
</code></pre>
<h2 id="importing-json-files"><a class="header" href="#importing-json-files">Importing JSON files</a></h2>
<ul>
<li>Extensions: <code>.json</code></li>
</ul>
<pre><code class="language-js">// imports vehicles.json as a JavaScript value (an array, object).
import data from &quot;./vehicles.json&quot;;
</code></pre>
<h2 id="importing-other-formats"><a class="header" href="#importing-other-formats">Importing other formats</a></h2>
<p>CLEO Redux supports custom file loaders. The purpose of a loader is to load a provided file, parse it and serialize into a JSON string suitable for the use in JavaScript. Those loaders are implemented as <a href="./installation-plugins.html">CLEO plugins</a> and use <a href="./using-sdk.html#developing-file-loaders">CLEO SDK</a> to associate itself with particular file extensions.</p>
<p>Default CLEO installation includes loaders for <code>.txt</code> and <code>.ide</code> files.</p>
<h3 id="txt"><a class="header" href="#txt">TXT</a></h3>
<ul>
<li>Extensions: <code>.txt</code>, <code>.text</code></li>
<li>Plugin name: <code>TextLoader.cleo</code></li>
</ul>
<p>The TXT loader transforms a text file into an array of strings where each element is a line in the text file. For an empty file an empty array is constructed. If the file can not be open for reading the import statement raises an exception.</p>
<pre><code class="language-js">import lines from &quot;./some-file.txt&quot;;

for (const line of lines) {
  log(line); // prints a line
}
</code></pre>
<p>This script prints each line from the <code>some-file.txt</code> file into the log. If you need the content of the file as a single string use <code>.join('')</code> method to concatenate all array elements:</p>
<pre><code class="language-js">import lines from &quot;./some-file.txt&quot;;

log(lines.join(&quot;&quot;)); // prints the entire file
</code></pre>
<h3 id="ide"><a class="header" href="#ide">IDE</a></h3>
<ul>
<li>Extensions: <code>.ide</code></li>
<li>Plugin name: <code>IdeLoader.cleo</code></li>
</ul>
<p>The IDE loader transforms an item definition file (<code>*.ide</code>) that is widely used in GTA series games. The file is imported as an object where each key corresponds to a section in the file and the value is an array of array of strings:</p>
<pre><code class="language-ts">interface Ide {
  [key: string]: Array&lt;Array&lt;string&gt;&gt;;
}
</code></pre>
<p>A first-level array represents a list of lines within this section in the file, and a second-level array represents a list of columns within that line. E.g. the following IDE file</p>
<pre><code>peds
0, null, generic, PLAYER1, STAT_PLAYER, player, 7f
1, cop, cop, COP, STAT_COP, man, 7f
end

objs
170, grenade, generic, 1, 100, 0
end

</code></pre>
<p>would be transformed into:</p>
<pre><code class="language-json">{
  &quot;peds&quot;: [
    [&quot;0&quot;, &quot;null&quot;, &quot;generic&quot;, &quot;PLAYER1&quot;, &quot;STAT_PLAYER&quot;, &quot;player&quot;, &quot;7f&quot;],
    [&quot;1&quot;, &quot;cop&quot;, &quot;cop&quot;, &quot;COP&quot;, &quot;STAT_COP&quot;, &quot;man&quot;, &quot;7f&quot;]
  ],
  &quot;objs&quot;: [&quot;170&quot;, &quot;grenade&quot;, &quot;generic&quot;, &quot;1&quot;, &quot;100&quot;, &quot;0&quot;]
}
</code></pre>
<p>Note that each data element becomes a string, even if it was a number in the original file. The loader does not make any assumption about specific sections, nor validate them. It follows a few simple rules where each section should start with an identifier (&quot;peds&quot;, &quot;objs&quot;) and end with the &quot;end&quot; string. It considers each line to be a comma- or space-separated set of columns that could be anything.</p>
<pre><code class="language-js">// read data/default.ide file in the game directory
import data from &quot;data/default.ide&quot;;

// read &quot;peds&quot; section from the file
const peds = data.peds;

// find a line in the peds section where the second element (column) is &quot;cop&quot;
const cop = peds.find((line) =&gt; line[1] === &quot;cop&quot;);

// if the line is found print the model id from the first column
if (cop) {
  log(&quot;Cop model ID is &quot; + parseInt(cop[0]));
} else {
  log(&quot;Model with the name 'cop' not found&quot;);
}
</code></pre>
<p>This script shows how you can use <code>.find</code> and other common array methods to find a line in the imported IDE file and use it. It prints <code>1</code> when given a file with the content shown above.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="asynchronous-programming"><a class="header" href="#asynchronous-programming">Asynchronous Programming</a></h1>
<ul>
<li><a href="async.html#async-api">Async API</a></li>
<li><a href="async.html#async-functions">Async Functions</a></li>
<li><a href="async.html#concurrent-async-functions">Concurrent Async Functions</a></li>
<li><a href="async.html#dynamic-imports">Dynamic Imports</a></li>
<li><a href="async.html#settimeout-and-setinterval">setTimeout and setInterval</a></li>
</ul>
<p>CLEO Redux supports asynchronous code via <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a> and <code>async/await</code> syntax. This enables lots of advanced code patterns.</p>
<p>Note that asynchoronous programming is a fairly complex topic and if you want to learn more about visit the following resources:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Introducing">MDN</a></li>
<li><a href="https://javascript.info/async">JavaScript.info</a></li>
</ul>
<p>See an example of an async script for GTA III <a href="https://github.com/x87/luigi3_async">here</a>.</p>
<h2 id="async-api"><a class="header" href="#async-api">Async API</a></h2>
<p>CLEO Redux 1.0.4 has one native async command: <code>asyncWait</code>. This command pauses the script for a specified amount of time. It returns a <code>Promise</code> that resolves after the specified amount of time. <code>asyncWait</code> can only be used inside an <code>async</code> function.</p>
<pre><code class="language-js">async function delay(ms) {
  log(&quot;Waiting for &quot; + ms + &quot;ms&quot;);
  await asyncWait(ms);
  log(&quot;Done waiting&quot;);
}

delay(1000);
</code></pre>
<p>Difference between <code>asyncWait</code> and <code>wait</code> is that the former is not a blocking command. If you don't put the <code>await</code> keyword in front of it, the script execution continues.</p>
<pre><code class="language-js">async function delay(ms) {
  log(&quot;Waiting for &quot; + ms + &quot;ms&quot;);
  asyncWait(ms); // no await here, the script continues
  log(&quot;Executed immediately&quot;);
}

delay(1000);
</code></pre>
<h2 id="async-functions"><a class="header" href="#async-functions">Async Functions</a></h2>
<p>CLEO Redux does not support a top-level await. This means that you cannot use the <code>await</code> keyword in the main body of the script.</p>
<pre><code class="language-js">// script begins
await asyncWait(1000); // won't work
showTextBox(&quot;Hello&quot;);
</code></pre>
<p>To bypass this limitation wrap your code in an anonymous async function.</p>
<pre><code class="language-js">(async function () {
  // script begins
  await asyncWait(1000); // works, because it's inside an async function
  showTextBox(&quot;Hello&quot;);
})();
</code></pre>
<p>Note that by design any exception thrown inside an async function is not caught automatically. This means that if you want to catch an exception you need to wrap your code in a try/catch block or add <code>.catch</code> handler to the promise.</p>
<pre><code class="language-js">(async function () {
  // script code goes here
  non_existing_function();
})().catch((e) =&gt; {
  log(e);
});
</code></pre>
<p>The log will contain the following message:</p>
<pre><code>&quot;ReferenceError: 'non_existing_function' is not defined&quot;
</code></pre>
<h2 id="concurrent-async-functions"><a class="header" href="#concurrent-async-functions">Concurrent Async Functions</a></h2>
<p>One of the advantages of async functions is that they could run concurrently. This means that you can run multiple async functions at the same time. Some languages call these coroutines.</p>
<pre><code class="language-js">import { KeyCode } from &quot;./.config/enums&quot;;
let gVar = 0;

(async () =&gt; {
  await asyncWait(0);

  // running task1, task2, and task3 concurrently
  task1();
  task2();
  task3();
})();

// shakes the camera
async function task1() {
  while (true) {
    await asyncWait(0);
    Camera.Shake(30);
  }
}

// awards the player with $1000 every second and increments the global variable gVar
async function task2() {
  let p = new Player(0);
  while (true) {
    await asyncWait(1000);

    p.addScore(1);
    gVar++;
  }
}

// waits for the button J to be pressed and displays the value of gVar
async function task3() {
  while (true) {
    await asyncWait(0);
    if (Pad.IsKeyDown(KeyCode.J)) {
      showTextBox(&quot;gVar is &quot; + gVar);
    }
  }
}
</code></pre>
<p>This is very similar to writing traditional <code>while(true){}</code> loops with a <code>wait</code> command in it, with the difference that the functions must have <code>async</code> keyword and use <code>asyncWait</code> instead of <code>wait</code>
Each of the three tasks are executed independently from each other. Note that runtime guarantees that all async functions are executed in the same thread. They share global variables and can change them. Look at how <code>gVar</code> is being incremented in <code>task2</code> and read in <code>task3</code>.</p>
<h2 id="dynamic-imports"><a class="header" href="#dynamic-imports">Dynamic Imports</a></h2>
<p>CLEO Redux supports <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import">dynamic imports</a>. It allows to load script files on-demand when they are needed. This is useful for large scripts that are not needed all the time.</p>
<pre><code class="language-js">(async () =&gt; {
  if (somethingIsTrue) {
    // import module for side effects
    await import(&quot;./my-module.mjs&quot;);
  }
})();
</code></pre>
<p>Imported modules can export functions and variables. They can be used in the same way as in regular scripts.</p>
<p>my-module.mjs:</p>
<pre><code class="language-js">export const myVar = 42;
</code></pre>
<p>main.js:</p>
<pre><code class="language-js">(async () =&gt; {
  const { myVar } = await import(&quot;./my-module.mjs&quot;);
  log(myVar); // prints 42
})();
</code></pre>
<p>When importing JSON files, its content is available via <code>default</code> property.</p>
<pre><code class="language-js">(async function () {
  const { default: data } = await import(&quot;./my.json&quot;);

  log(data); // prints the content of my.json
})();
</code></pre>
<h2 id="settimeout-and-setinterval"><a class="header" href="#settimeout-and-setinterval">setTimeout and setInterval</a></h2>
<p>It is easy to implement <code>setTimeout</code> and <code>setInterval</code> using <code>asyncWait</code> and <code>async</code> functions. You can <a href="https://github.com/cleolibrary/CLEO-Redux/blob/master/examples/setTimeout%2C%20setInterval.js">find an implementation example here</a>.</p>
<p>Since 1.0.6 these functions are <a href="./api.html">part of the standard library</a> and are available in all scripts.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="events"><a class="header" href="#events">Events</a></h1>
<p>CLEO Redux 1.0.6 adds initial support for event-driven scripting. This feature allows you to write scripts that react to events that happen in the game or another scripts.</p>
<ul>
<li><a href="events.html#listening-to-events">Listening to events</a></li>
<li><a href="events.html#list-of-events">List of events</a>
<ul>
<li><a href="events.html#onvehiclecreate">OnVehicleCreate</a></li>
<li><a href="events.html#onpedcreate">OnPedCreate</a></li>
<li><a href="events.html#onobjectcreate">OnObjectCreate</a></li>
<li><a href="events.html#onvehicledelete">OnVehicleDelete</a></li>
<li><a href="events.html#onpeddelete">OnPedDelete</a></li>
<li><a href="events.html#onobjectdelete">OnObjectDelete</a></li>
</ul>
</li>
<li><a href="events.html#creating-your-own-events">Creating your own events</a></li>
<li><a href="events.html#dispatching-events-from-scripts">Dispatching events from scripts</a></li>
</ul>
<h2 id="listening-to-events"><a class="header" href="#listening-to-events">Listening to events</a></h2>
<p>A globally available <code>addEventListener</code> function creates a new event listener. It takes two arguments: an event name and a function that will be called when the event is triggered (a callback).</p>
<p>The event name argument corresponds to <a href="events.html#list-of-events">built-in</a> or <a href="events.html#dispatching-events-from-scripts">custom</a> event names.</p>
<p>The callback receives a single argument. This argument is a JavaScript object with two fields: <code>name</code> (the event name) and <code>data</code> (custom data associated with this event).</p>
<blockquote>
<p>Event listeners only work in <a href="./async.html">async context</a>. Scripts willing to react to game events must not use a blocking <code>wait</code> function. Use <code>asyncWait</code> instead.</p>
</blockquote>
<pre><code class="language-js">addEventListener(&quot;OnVehicleCreate&quot;, (event) =&gt; {
  log(&quot;A vehicle is created!&quot;);
  log(event.name); // logs &quot;OnVehicleCreate&quot;
});
</code></pre>
<p><code>addEventListener</code> returns a function that can be used to stop listening to the event. This is useful when you want to stop listening to the event after a certain condition is met.</p>
<pre><code class="language-js">const cancel = addEventListener(&quot;OnVehicleCreate&quot;, (event) =&gt; {
  log(&quot;A vehicle is created!&quot;);
});

// ...

cancel(); // the event callback won't be called anymore
</code></pre>
<h2 id="list-of-events"><a class="header" href="#list-of-events">List of events</a></h2>
<blockquote>
<p>The following documentation describes the Events.cleo plugin shipped with CLEO Redux 1.0.6+. Other plugins may add their own events.
Events are game- and version- specific. Some of them might not be available on certain games or versions.</p>
</blockquote>
<h3 id="onvehiclecreate"><a class="header" href="#onvehiclecreate">OnVehicleCreate</a></h3>
<p>Triggered after the game creates a new vehicle of any type in the world. An event's <code>data</code> object contains the address of the vehicle structure.</p>
<p>Supported in: <code>re3</code>, <code>reVC</code>, <code>GTA III</code>, <code>GTA VC</code>, <code>GTA SA</code>, <code>GTA III: DE (1.0.17.39540)</code>, <code>GTA VC: DE (1.0.17.39540)</code>, <code>GTA SA: DE (1.0.17.39540)</code></p>
<pre><code class="language-ts">interface OnVehicleCreateEvent {
  name: string;
  data: {
      address: int;
  }
}

addEventListener(&quot;OnVehicleCreate&quot;, (event: OnVehicleCreateEvent) =&gt; {
  const name = event.name;
  log(`Event ${name} is triggered!`}); // logs &quot;Event OnVehicleCreate is triggered!&quot;

  const address = event.data.address;
  log(&quot;A vehicle is created! Its address is &quot; + address); // logs &quot;A vehicle is created! Its address is 0x12345678&quot;
});
</code></pre>
<h3 id="onpedcreate"><a class="header" href="#onpedcreate">OnPedCreate</a></h3>
<p>Triggered after the game creates a new ped of any type in the world. An event's <code>data</code> object contains the address of the ped structure.</p>
<p>Supported in: <code>re3</code>, <code>reVC</code>, <code>GTA III</code>, <code>GTA VC</code>, <code>GTA SA</code>, <code>GTA III: DE (1.0.17.39540)</code>, <code>GTA VC: DE (1.0.17.39540)</code>, <code>GTA SA: DE (1.0.17.39540)</code></p>
<pre><code class="language-ts">interface OnPedCreateEvent {
  name: string;
  data: {
    address: int;
  };
}

addEventListener(&quot;OnPedCreate&quot;, (event: OnPedCreateEvent) =&gt; {
  const name = event.name;
  log(`Event ${name} is triggered!`); // logs &quot;Event OnPedCreate is triggered!&quot;

  const address = event.data.address;
  log(&quot;A ped is created! Its address is &quot; + address); // logs &quot;A ped is created! Its address is 0x12345678&quot;
});
</code></pre>
<h3 id="onobjectcreate"><a class="header" href="#onobjectcreate">OnObjectCreate</a></h3>
<p>Triggered after the game creates a new object of any type in the world. An event's <code>data</code> object contains the address of the object structure.</p>
<p>Supported in: <code>re3</code>, <code>reVC</code>, <code>GTA III</code>, <code>GTA VC</code>, <code>GTA SA</code>, <code>GTA III: DE (1.0.17.39540)</code>, <code>GTA VC: DE (1.0.17.39540)</code>, <code>GTA SA: DE (1.0.17.39540)</code></p>
<pre><code class="language-ts">interface OnObjectCreateEvent {
  name: string;
  data: {
    address: int;
  };
}

addEventListener(&quot;OnObjectCreate&quot;, (event: OnObjectCreateEvent) =&gt; {
  const name = event.name;
  log(`Event ${name} is triggered!`); // logs &quot;Event OnObjectCreate is triggered!&quot;

  const address = event.data.address;
  log(&quot;An object is created! Its address is &quot; + address); // logs &quot;An object is created! Its address is 0x12345678&quot;
});
</code></pre>
<h3 id="onvehicledelete"><a class="header" href="#onvehicledelete">OnVehicleDelete</a></h3>
<p>Triggered <em>before</em> the game deletes a vehicle from the world. An event's <code>data</code> object contains the address of the vehicle structure.</p>
<p>Supported in: <code>re3</code>, <code>reVC</code>, <code>GTA III</code>, <code>GTA VC</code>, <code>GTA SA</code>, <code>GTA III: DE (1.0.17.39540)</code>, <code>GTA VC: DE (1.0.17.39540)</code>, <code>GTA SA: DE (1.0.17.39540)</code></p>
<pre><code class="language-ts">interface OnVehicleDeleteEvent {
  name: string;
  data: {
    address: int;
  };
}

addEventListener(&quot;OnVehicleDelete&quot;, (event: OnVehicleDeleteEvent) =&gt; {
  const name = event.name;
  log(`Event ${name} is triggered!`); // logs &quot;Event OnVehicleDelete is triggered!&quot;

  const address = event.data.address;
  log(&quot;A vehicle is about to be deleted! Its address is &quot; + address); // logs &quot;A vehicle is about to be deleted! Its address is 0x12345678&quot;
});
</code></pre>
<h3 id="onpeddelete"><a class="header" href="#onpeddelete">OnPedDelete</a></h3>
<p>Triggered <em>before</em> the game deletes a ped from the world. An event's <code>data</code> object contains the address of the ped structure.</p>
<p>Supported in: <code>re3</code>, <code>reVC</code>, <code>GTA III</code>, <code>GTA VC</code>, <code>GTA SA</code>, <code>GTA III: DE (1.0.17.39540)</code>, <code>GTA VC: DE (1.0.17.39540)</code>, <code>GTA SA: DE (1.0.17.39540)</code></p>
<pre><code class="language-ts">interface OnPedDeleteEvent {
  name: string;
  data: {
    address: int;
  };
}

addEventListener(&quot;OnPedDelete&quot;, (event: OnPedDeleteEvent) =&gt; {
  const name = event.name;
  log(`Event ${name} is triggered!`); // logs &quot;Event OnPedDelete is triggered!&quot;

  const address = event.data.address;
  log(&quot;A ped is about to be deleted! Its address is &quot; + address); // logs &quot;A ped is about to be deleted! Its address is 0x12345678&quot;
});
</code></pre>
<h3 id="onobjectdelete"><a class="header" href="#onobjectdelete">OnObjectDelete</a></h3>
<p>Triggered <em>before</em> the game deletes an object from the world. An event's <code>data</code> object contains the address of the object structure.</p>
<p>Supported in: <code>re3</code>, <code>reVC</code>, <code>GTA III</code>, <code>GTA VC</code>, <code>GTA SA</code>, <code>GTA III: DE (1.0.17.39540)</code>, <code>GTA VC: DE (1.0.17.39540)</code>, <code>GTA SA: DE (1.0.17.39540)</code></p>
<pre><code class="language-ts">interface OnObjectDeleteEvent {
  name: string;
  data: {
    address: int;
  };
}

addEventListener(&quot;OnObjectDelete&quot;, (event: OnObjectDeleteEvent) =&gt; {
  const name = event.name;
  log(`Event ${name} is triggered!`); // logs &quot;Event OnObjectDelete is triggered!&quot;

  const address = event.data.address;
  log(&quot;An object is about to be deleted! Its address is &quot; + address); // logs &quot;An object is about to be deleted! Its address is 0x12345678&quot;
});
</code></pre>
<h2 id="creating-your-own-events"><a class="header" href="#creating-your-own-events">Creating your own events</a></h2>
<p><a href="./using-sdk.html">CLEO Redux SDK</a> provides a method called <code>TriggerEvent</code> that can be used to emit a new event along with some payload. The plugin must decide when the event should be triggered (usually by hooking into a game function). See the <a href="https://github.com/cleolibrary/CLEO-Redux/tree/master/plugins/Events">Events.cleo</a> plugin source code for an example.</p>
<p><code>TriggerEvent</code> has two parameters: an event name and a serialized JSON. It will be passed to the event listeners as the <code>data</code> property of the event object.</p>
<h2 id="dispatching-events-from-scripts"><a class="header" href="#dispatching-events-from-scripts">Dispatching events from scripts</a></h2>
<p>Dispatching events is a safe way for scripts to communicate with each other. For example, one script can dispatch an event when the player enters a specific area, and another script can listen to that event and perform some action. <code>dispatchEvent</code> function creates a new custom event. It has the following signature:</p>
<pre><code class="language-ts">function dispatchEvent(name: string, data: any): void;
</code></pre>
<p>The <code>name</code> parameter is the name of the event to dispatch. It corresponds to the <code>name</code> argument in <code>addEventListener</code>. The <code>data</code> is an optional payload that will be passed to the <a href="events.html#listening-to-events">event listeners</a> as the <code>data</code> property of the event object. The payload can be any JSON-serializable value (e.g. functions are not allowed).</p>
<pre><code class="language-ts">// Dispatch an event from a script
dispatchEvent(&quot;OnMyCustomEvent&quot;, { foo: &quot;bar&quot; });

// Listen to the event in a script
addEventListener(&quot;OnMyCustomEvent&quot;, (event) =&gt; {
  log(event.data.foo); // logs &quot;bar&quot;
});
</code></pre>
<h2 id="using-events-in-typescript"><a class="header" href="#using-events-in-typescript">Using events in TypeScript</a></h2>
<p>Both <code>addEventListener</code> and <code>dispatchEvent</code> are generic functions that can be used to type-check event names and payloads. The following example shows how to use them in TypeScript:</p>
<pre><code class="language-ts">// Define an event payload
export interface WantedLevelChangeEvent {
  oldWantedLevel: number;
  newWantedLevel: number;
  change: number;
}

// Dispatch an event
dispatchEvent&lt;WantedLevelChangeEvent&gt;(&quot;OnWantedLevelChange&quot;, {
  oldWantedLevel: 0,
  newWantedLevel: 1,
  change: 1,
});

// Listen to the event
addEventListener&lt;WantedLevelChangeEvent&gt;(&quot;OnWantedLevelChange&quot;, (event) =&gt; {
  log(event.data.oldWantedLevel); // logs 0
  log(event.data.newWantedLevel); // logs 1
  log(event.data.change); // logs 1
});
</code></pre>
<p><code>WantedLevelChangeEvent</code> type allows VS Code to provide auto-completion and type-checking for the event payload.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="javascript-api"><a class="header" href="#javascript-api">JavaScript API</a></h1>
<ul>
<li><a href="api.html#native-functions">Native functions</a></li>
<li><a href="api.html#cleo-redux-bindings">CLEO Redux Bindings</a>
<ul>
<li><a href="api.html#variables">Variables</a>
<ul>
<li><a href="api.html#host">HOST</a></li>
<li><a href="api.html#onmission">ONMISSION</a></li>
<li><a href="api.html#timera-timerb">TIMERA, TIMERB</a></li>
<li><a href="api.html#__dirname">__dirname</a></li>
<li><a href="api.html#__filename">__filename</a></li>
</ul>
</li>
<li><a href="api.html#functions">Functions</a>
<ul>
<li><a href="api.html#addeventlistener">addEventListener</a></li>
<li><a href="api.html#asyncwait">asyncWait</a></li>
<li><a href="api.html#cleartimeout">clearTimeout</a></li>
<li><a href="api.html#clearinterval">clearInterval</a></li>
<li><a href="api.html#dispatchevent">dispatchEvent</a></li>
<li><a href="api.html#exit">exit</a></li>
<li><a href="api.html#log">log</a></li>
<li><a href="api.html#native">native</a></li>
<li><a href="api.html#setinterval">setInterval</a></li>
<li><a href="api.html#settimeout">setTimeout</a></li>
<li><a href="api.html#showtextbox">showTextBox</a></li>
<li><a href="api.html#wait">wait</a></li>
</ul>
</li>
<li><a href="api.html#static-objects">Static Objects</a>
<ul>
<li><a href="api.html#memory">Memory</a></li>
<li><a href="api.html#math">Math</a></li>
<li><a href="api.html#fxtstore">FxtStore</a></li>
<li><a href="api.html#cleo">CLEO</a>
<ul>
<li><a href="api.html#cleodebug">CLEO.debug</a></li>
<li><a href="api.html#cleoversion">CLEO.version</a></li>
<li><a href="api.html#cleoapiversion">CLEO.apiVersion</a></li>
<li><a href="api.html#cleohostversion">CLEO.hostVersion</a></li>
<li><a href="api.html#cleorunscript">CLEO.runScript</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="native-functions"><a class="header" href="#native-functions">Native functions</a></h2>
<p>CLEO Redux supports all commands native to the current game. In the classic GTA 3D series they are also known as <em>opcodes</em>. In GTA IV they are known as <em>native functions</em>. You can find them in <a href="https://library.sannybuilder.com/">Sanny Builder Library</a>.</p>
<p>Each available command has a predefined name that the game associates with a particular set of instructions running as you execute that command with arguments. To call a command by name use a built-in function <a href="./api#native"><code>native</code></a>. For example, to change the player's health run <code>native(&quot;SET_PLAYER_HEALTH&quot;, 0, 100)</code>, where <code>0</code> is the player's id and <code>100</code> is the desired health.</p>
<p>For convenience, CLEO Redux also defines a wide set of abstractions on top of the native functions called <em>classes</em>. Each class represents a group of commands around some domain, e.g. commands related to the player, vehicles, or text display can be found in classes <code>Player</code>, <code>Car</code>, or <code>Text</code> respectively. You can browse available classes and their methods in Sanny Builder Library.</p>
<p>For example, to change the player's health using classes run <code>p.setHealth(100)</code>, where <code>p</code> is an instance of the <code>Player</code> class created with <code>new Player()</code> or <code>Player.Create</code> functions.</p>
<h2 id="cleo-redux-bindings"><a class="header" href="#cleo-redux-bindings">CLEO Redux Bindings</a></h2>
<p>In addition to native commands CLEO Redux adds extra variables and functions.</p>
<h3 id="variables-1"><a class="header" href="#variables-1">Variables</a></h3>
<h4 id="host-1"><a class="header" href="#host-1">HOST</a></h4>
<p>the host name (previously available as <code>GAME</code> variable). Possible values are <code>gta3</code>, <code>vc</code>, <code>re3</code>, <code>reVC</code>, <code>sa</code>, <code>gta3_unreal</code>, <code>vc_unreal</code>, <code>sa_unreal</code>, <code>gta_iv</code>, <code>bully</code>, <code>unknown</code>.</p>
<p>CLEO plugins can use SDK to customize the name for their needs.</p>
<pre><code class="language-js">if (HOST === &quot;gta3&quot;) {
  showTextBox(&quot;This is GTA III&quot;);
}
if (HOST === &quot;sa&quot;) {
  showTextBox(&quot;This is San Andreas&quot;);
}
if (HOST === &quot;unknown&quot;) {
  showTextBox(&quot;This host is not natively supported&quot;);
}
</code></pre>
<h4 id="onmission"><a class="header" href="#onmission">ONMISSION</a></h4>
<p>the global flag controlling whether the player is on a mission now. Not available on an <code>unknown</code> host.</p>
<pre><code class="language-js">if (!ONMISSION) {
  showTextBox(&quot;Not on a mission. Setting ONMISSION to true&quot;);
  ONMISSION = true;
}
</code></pre>
<p>Setting <code>ONMISSION</code> to <code>true</code> has a side effect of turning the current script into a mission script, e.g. you can use mission-only commands, such as <code>STORE_CAR_CHAR_IS_IN</code> or <code>MISSION_HAS_FINISHED</code>. Setting <code>ONMISSION</code> to <code>false</code> turns the current script into a normal script.</p>
<h4 id="timera-timerb"><a class="header" href="#timera-timerb">TIMERA, TIMERB</a></h4>
<p>two auto-incrementing timers useful for measuring time intervals.</p>
<pre><code class="language-js">while (true) {
  TIMERA = 0;
  // wait 1000 ms
  while (TIMERA &lt; 1000) {
    wait(0);
  }
  showTextBox(&quot;1 second passed&quot;);
}
</code></pre>
<h4 id="__dirname"><a class="header" href="#__dirname">__dirname</a></h4>
<p>an absolute path to the directory with the current file</p>
<h4 id="__filename"><a class="header" href="#__filename">__filename</a></h4>
<p>an absolute path to the current file</p>
<h3 id="functions-1"><a class="header" href="#functions-1">Functions</a></h3>
<h4 id="addeventlistener"><a class="header" href="#addeventlistener">addEventListener</a></h4>
<p><code>addEventListener(name, callback)</code> calls the <code>{callback}</code> function every time an <a href="./events.html">event</a> with the specified <code>{name}</code> is triggered. The <code>{callback}</code> function accepts a single argument that contains event-specific data. <code>addEventListener</code> returns a function that can be used to remove the listener.</p>
<pre><code class="language-js">const cancel = addEventListener(&quot;OnVehicleCreate&quot;, (event) =&gt; {
  log(&quot;A vehicle is created!&quot;);
});

// ...

cancel(); // the event callback won't be called anymore
</code></pre>
<h4 id="asyncwait"><a class="header" href="#asyncwait">asyncWait</a></h4>
<p><code>await asyncWait(timeInMs)</code> pauses the script execution for at least <code>{timeInMs}</code> milliseconds. <code>asyncWait</code> can be used in async functions.</p>
<pre><code class="language-js">async function loop() {
  while (true) {
    await asyncWait(1000);
    log(&quot;1 second passed&quot;);
  }
}
</code></pre>
<h4 id="cleartimeout"><a class="header" href="#cleartimeout">clearTimeout</a></h4>
<p>See <a href="api.html#settimeout">setTimeout</a>.</p>
<h4 id="clearinterval"><a class="header" href="#clearinterval">clearInterval</a></h4>
<p>See <a href="api.html#setinterval">setInterval</a>.</p>
<h4 id="dispatchevent"><a class="header" href="#dispatchevent">dispatchEvent</a></h4>
<p><code>dispatchEvent(name, data?)</code> triggers a custom event with the specified <code>{name}</code> and <code>{data}</code>. The <code>{data}</code> argument is optional. The event can be caught by <a href="api.html#addeventlistener"><code>addEventListener</code></a> function from any active script.</p>
<pre><code class="language-js">addEventListener(&quot;greeting&quot;, (event) =&gt; {
  log(event.data); // prints &quot;hello&quot;
});

dispatchEvent(&quot;greeting&quot;, &quot;hello&quot;);
</code></pre>
<h4 id="exit"><a class="header" href="#exit">exit</a></h4>
<p><code>exit(reason?)</code> terminates the script immediately. <code>exit</code> function accepts an optional string argument that will be added to the <code>cleo_redux.log</code>.</p>
<pre><code class="language-js">exit(&quot;Script ended&quot;);
</code></pre>
<h4 id="log"><a class="header" href="#log">log</a></h4>
<p><code>log(...values)</code> prints comma-separated <code>{values}</code> to the <code>cleo_redux.log</code></p>
<pre><code class="language-js">var x = 1;
log(&quot;value of x is &quot;, x);
</code></pre>
<h4 id="native"><a class="header" href="#native">native</a></h4>
<p><code>native(command_name, ...input_args)</code> is a low-level function to execute a command using its name <code>{command_name}</code>. The command name matches <code>name</code> property in a JSON file provided by Sanny Builder Library.</p>
<pre><code class="language-js">native(&quot;SET_TIME_OF_DAY&quot;, 12, 30); // sets the time of day to 12:30
</code></pre>
<p>For the commands that return a single value, the result is this value.</p>
<pre><code class="language-js">const progress = native(&quot;GET_PROGRESS_PERCENTAGE&quot;);
showTextBox(`Progress is ${progress}`);
</code></pre>
<p>For the commands that return multiple values, the result is an object where each key corresponds to a returned value. The key names match the output names given in the command definition</p>
<pre><code class="language-js">var pos = native(&quot;GET_CHAR_COORDINATES&quot;, char); // returns char's coordinates vector {x, y, z}
showTextBox(`Character pos: x ${pos.x} y ${pos.y} z ${pos.z}`);
</code></pre>
<p>For the conditional commands the result is the boolean value <code>true</code> or <code>false</code></p>
<pre><code class="language-js">if (native(&quot;HAS_MODEL_LOADED&quot;, 101)) {
  // checks the condition
  showTextBox(&quot;Model with id 101 has been loaded&quot;);
}
</code></pre>
<h4 id="setinterval"><a class="header" href="#setinterval">setInterval</a></h4>
<p><code>setInterval(callback, timeInMs?)</code> calls the <code>{callback}</code> function every <code>{timeInMs}</code> milliseconds (or <code>0</code> if the argument is not present).</p>
<p><code>setInterval</code> returns an unique id that can be used to cancel the interval early using <a href="api.html#clearinterval">clearInterval</a>.</p>
<pre><code class="language-js">let intervalId = setInterval(() =&gt; {
  showTextBox(&quot;1 second passed&quot;);
}, 1000);

clearInterval(intervalId); // the callback won't be called anymore
</code></pre>
<h4 id="settimeout"><a class="header" href="#settimeout">setTimeout</a></h4>
<p><code>setTimeout(callback, timeInMs?)</code> calls the <code>{callback}</code> function after <code>{timeInMs}</code> milliseconds (or <code>0</code> if the argument is not present).</p>
<p><code>setTimeout</code> returns an unique id that can be used to cancel the timeout early using <a href="api.html#cleartimeout">clearTimeout</a>.</p>
<pre><code class="language-js">let timeoutId = setTimeout(() =&gt; {
  exit(&quot;Terminate script);
}, 1000);

clearTimeout(timeoutId); // the callback won't be called
</code></pre>
<h4 id="showtextbox"><a class="header" href="#showtextbox">showTextBox</a></h4>
<p><code>showTextBox(text)</code> displays <code>{text}</code> in the black rectangular box. Not available on an <code>unknown</code> host.</p>
<pre><code class="language-js">showTextBox(&quot;Hello, world!&quot;);
</code></pre>
<h4 id="wait"><a class="header" href="#wait">wait</a></h4>
<p><code>wait(timeInMs)</code> pauses the script execution for at least <code>{timeInMs}</code> milliseconds</p>
<pre><code class="language-js">while (true) {
  wait(1000);
  log(&quot;1 second passed&quot;);
}
</code></pre>
<h3 id="static-objects"><a class="header" href="#static-objects">Static Objects</a></h3>
<h4 id="memory"><a class="header" href="#memory">Memory</a></h4>
<ul>
<li><code>Memory</code> object allows to manipulate the process memory. See the <a href="using-memory.html">Memory guide</a> for more information.</li>
</ul>
<h4 id="math"><a class="header" href="#math">Math</a></h4>
<ul>
<li><code>Math</code> object is a standard object available in the JS runtime that provides common mathematical operations. CLEO Redux extends it with some extra commands. See the <a href="using-math.html">Math object</a> for more information.</li>
</ul>
<h4 id="fxtstore"><a class="header" href="#fxtstore">FxtStore</a></h4>
<ul>
<li><code>FxtStore</code> allows to update the content of in-game texts. See the <a href="./using-fxt.html">Custom Text</a> guide for details.</li>
</ul>
<h4 id="cleo"><a class="header" href="#cleo">CLEO</a></h4>
<ul>
<li>
<p><code>CLEO</code> object provides access to the runtime information and utilities:</p>
<h5 id="cleodebug"><a class="header" href="#cleodebug">CLEO.debug</a></h5>
<ul>
<li><code>CLEO.debug.trace(flag)</code> toggles on and off command tracing in the current script. When {flag} is true all executed commands get added to <code>cleo_redux.log</code>:</li>
</ul>
<pre><code class="language-js">CLEO.debug.trace(true);
wait(50);
const p = new Player(0);
CLEO.debug.trace(false);
</code></pre>
<h5 id="cleoversion"><a class="header" href="#cleoversion">CLEO.version</a></h5>
<ul>
<li><code>CLEO.version</code> - a complex property providing information about current CLEO version</li>
</ul>
<pre><code class="language-js">log(CLEO.version); // &quot;0.9.4-dev.20220427&quot;
log(CLEO.version.major); // &quot;0&quot;
log(CLEO.version.minor); // &quot;9&quot;
log(CLEO.version.patch); // &quot;4&quot;
log(CLEO.version.pre); // &quot;dev&quot;
log(CLEO.version.build); // &quot;20220427&quot;
</code></pre>
<h5 id="cleoapiversion"><a class="header" href="#cleoapiversion">CLEO.apiVersion</a></h5>
<ul>
<li><code>CLEO.apiVersion</code> - a complex property providing information about current API (using <code>meta.version</code> field in the <a href="./definitions.html">primary definition</a> file). Scripts can use it to check if the user has a particular API version installed.</li>
</ul>
<pre><code class="language-js">log(CLEO.apiVersion); // &quot;0.219&quot;
log(CLEO.apiVersion.major); // &quot;0&quot;
log(CLEO.apiVersion.minor); // &quot;219&quot;
log(CLEO.apiVersion.patch); // undefined
log(CLEO.apiVersion.pre); // undefined
log(CLEO.apiVersion.build); // undefined
</code></pre>
<h5 id="cleohostversion"><a class="header" href="#cleohostversion">CLEO.hostVersion</a></h5>
<ul>
<li><code>CLEO.hostVersion</code> - a complex property providing information about the host version. Currently only available if the current exe file has version info (e.g. GTA IV or GTA Trilogy)</li>
</ul>
<pre><code class="language-js">log(CLEO.hostVersion); // &quot;1.2.0.43&quot;
log(CLEO.hostVersion.major); // &quot;1&quot;
log(CLEO.hostVersion.minor); // &quot;2&quot;
log(CLEO.hostVersion.patch); // &quot;0&quot;
log(CLEO.hostVersion.pre); // undefined
log(CLEO.hostVersion.build); // &quot;43&quot;
</code></pre>
<h5 id="cleorunscript"><a class="header" href="#cleorunscript">CLEO.runScript</a></h5>
<ul>
<li>
<p><code>CLEO.runScript(fileName, args?)</code> - method that spawns a new instance of the script. <code>fileName</code> is the path to the script to launch. <code>args</code> is an optional parameter to pass arguments to the script.</p>
<blockquote>
<p>Don't overuse this feature as spawning a new script is a costly operation. Avoid spawning too many scripts in a loop.</p>
</blockquote>
<p><code>runScript</code> has the following limitations:</p>
<ul>
<li>script files must have one of the following extensions: <code>.mjs</code>, <code>.js</code> (JS scripts), <code>.ts</code> (TS scripts), <code>.s</code> or <code>.cs</code> (CS scripts).</li>
<li>spawning CS scripts is not supported in the <a href="./relation-to-cleo-library.html#running-cleo-redux-as-an-addon-to-cleo-library">delegate mode</a> (i.e. won't work in GTA San Andreas with CLEO 4 installed.)</li>
</ul>
<p>When running a new script you can also provide arguments to it. <code>args</code> is a JavaScript object which keys correspond to variable names in the script. Key names for a CS script are numeric and correspond to local variables (0@, 1@, 2@, etc). JS scripts can receive both numbers and strings as arguments, whereas CS scripts can only receive numbers.</p>
<p>You can spawn multiple instances of the same script with different arguments.</p>
<h6 id="launching-a-new-js-script"><a class="header" href="#launching-a-new-js-script">Launching a new JS script</a></h6>
<p>Imagine that you have two files <code>main.js</code> and <code>child.mjs</code> in the CLEO directory:</p>
<p>main.js:</p>
<pre><code class="language-js">CLEO.runScript(&quot;./child.mjs&quot;, { a: 1, b: &quot;str&quot;, c: 10.5 });
</code></pre>
<p>child.mjs:</p>
<pre><code class="language-js">showTextBox(&quot;child.mjs was launched with: &quot; + a + &quot; &quot; + b + &quot; &quot; + c);
</code></pre>
<p>Now if you run the game you should see the following message: <code>child.mjs was launched with: 1 str 10.5</code>.</p>
<h6 id="launching-a-new-cs-script"><a class="header" href="#launching-a-new-cs-script">Launching a new CS script</a></h6>
<p>main.js:</p>
<pre><code class="language-js">CLEO.runScript(&quot;./child.cs&quot;, { 1: 500 });
</code></pre>
<p>child.cs:</p>
<pre><code>0109: player $PLAYER_CHAR money += 1@ // gives the player $500
0A93: terminate_this_custom_script
</code></pre>
<p>To pass floating-point numbers to a CS script use <code>Memory.FromFloat</code> function:</p>
<p>main.js:</p>
<pre><code class="language-js">CLEO.runScript(&quot;./child.cs&quot;, {
  0: Memory.FromFloat(-921.25),
  1: Memory.FromFloat(662.125),
  2: Memory.FromFloat(-100.0),
});
</code></pre>
<p>child.cs:</p>
<pre><code>00A1: set_char_coordinates $PLAYER_ACTOR x 0@ y 1@ z 2@ // teleports the player at -921.25 662.125 -100.0
0A93: terminate_this_custom_script
</code></pre>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fluent-interface"><a class="header" href="#fluent-interface">Fluent Interface</a></h1>
<iframe width="560" height="315" src="https://www.youtube.com/embed/LLgJ0fWbklg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Methods on constructible entities (such as <code>Player</code>, <code>Car</code>, <code>Char</code> -- any entities created via a constructor method) support chaining (also known as Fluent Interface). It allows to write code like this:</p>
<pre><code class="language-js">var p = new Player(0);

p.giveWeapon(2, 100)
  .setHealth(5)
  .setCurrentWeapon(2)
  .getChar()
  .setCoordinates(1144, -600, 14)
  .setBleeding(true);
</code></pre>
<p>Destructor methods interrupt the chain. E.g. given the code:</p>
<p><code>Char.Create(0, 0, 0, 0, 0).setCoordinates(0, 0, 0).delete()</code></p>
<p>the chain can not continue after delete method as the character gets removed and its handle is not longer valid.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="enums"><a class="header" href="#enums">Enums</a></h1>
<p>Many commands make use of enumerated types or <em>enums</em> for parameters with a finite range of allowed values. Each value in the range is associated with a text identifier so you don't have to memorize numbers for parameters such as weapon ids, ped types, key codes, etc. </p>
<blockquote>
<p>Enum values can be either numbers or strings.</p>
</blockquote>
<p>Enum names start with a capital letter similar to class names, e.g. <code>PedType</code>, <code>KeyCode</code>, <code>Button</code>. </p>
<p><a href="https://library.sannybuilder.com/">Sanny Builder Library</a> lists all known enums for each game. It also provides a <code>enums.js</code> file with all enums exported as JavaScript objects for use in scripts. CLEO Redux automatically downloads this file along with the primary definitions file and places it in the <code>.config</code> directory.</p>
<p>To use an enum in a script <a href="./imports.html">import</a> it like this:</p>
<pre><code class="language-js">import { EnumName } from &quot;./.config/enums&quot;; // replace EnumName with the actual name
</code></pre>
<p>You can also import all enums at once using the following syntax:</p>
<pre><code class="language-js">import * as enums from &quot;./.config/enums&quot;;
</code></pre>
<p>Then you can access values in the enum as regular properties in a JavaScript object:</p>
<pre><code class="language-js">import { KeyCode } from &quot;./.config/enums&quot;;

if (Pad.IsKeyPressed(KeyCode.A)) {
  log(&quot;A is pressed&quot;);
}
</code></pre>
<p>or</p>
<pre><code class="language-js">import * as enums from &quot;./.config/enums&quot;;

if (Pad.IsKeyPressed(enums.KeyCode.A)) {
  log(&quot;A is pressed&quot;);
}
</code></pre>
<p>You can iterate over enum fields by using <code>Object.values</code>, <code>Object.keys</code>, or <code>Object.entries</code> functions:</p>
<pre><code class="language-js">Object.keys(KeyCode).forEach((key) =&gt; {
  log(key);
});

Object.values(KeyCode).forEach((value) =&gt; {
  log(value);
});

Object.keys(KeyCode).forEach(([key, value]) =&gt; {
  log(key, value);
});
</code></pre>
<p>If you find an issue with an enum, a missing or incorrect value, report it in Sanny Builder Library <a href="https://github.com/sannybuilder/library">repo on GitHub</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scriptobject-vs-object"><a class="header" href="#scriptobject-vs-object">ScriptObject vs Object</a></h1>
<p>Sanny Builder Library defines a static class <code>Object</code> to group commands allowing to create and manipulate 3D objects in-game. At the same time JavaScript has the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">native Object class</a> with its own methods.</p>
<p>To avoid mixing the two, CLEO Redux uses <code>ScriptObject</code> class instead of the Library's <code>Object</code> with <a href="https://library.sannybuilder.com/#/gta3/classes/Object">the same interface</a>.</p>
<pre><code class="language-js">// opcode 0107, creates a new object in the game
var x = ScriptObject.Create(modelId, x, y, z); 

// native JavaScript code, creates a new object in JS memory
var x = Object.create(null); 
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-math-object"><a class="header" href="#using-math-object">Using Math Object</a></h1>
<p>JavaScript has a built-in <code>Math</code> object that provides common mathematical operations, such as <code>abs</code>, <code>sin</code>, <code>cos</code>, <code>random</code>, <code>pow</code>, <code>sqr</code>, etc. CLEO Redux extends this object to include extra operations supported by the game. The interface of <code>Math</code> looks as follows:</p>
<pre><code class="language-ts">interface Math {
    // native code
    readonly E: number;
    readonly LN10: number;
    readonly LN2: number;
    readonly LOG2E: number;
    readonly LOG10E: number;
    readonly PI: number;
    readonly SQRT1_2: number;
    readonly SQRT2: number;
    abs(x: number): number;
    acos(x: number): number;
    asin(x: number): number;
    atan(x: number): number;
    atan2(y: number, x: number): number;
    ceil(x: number): number;
    cos(x: number): number;
    exp(x: number): number;
    floor(x: number): number;
    log(x: number): number;
    max(...values: number[]): number;
    min(...values: number[]): number;
    pow(x: number, y: number): number;
    random(): number;
    round(x: number): number;
    sin(x: number): number;
    sqrt(x: number): number;
    tan(x: number): number;
    clz32(x: number): number;
    imul(x: number, y: number): number;
    sign(x: number): number;
    log10(x: number): number;
    log2(x: number): number;
    log1p(x: number): number;
    expm1(x: number): number;
    cosh(x: number): number;
    sinh(x: number): number;
    tanh(x: number): number;
    acosh(x: number): number;
    asinh(x: number): number;
    atanh(x: number): number;
    hypot(...values: number[]): number;
    trunc(x: number): number;
    fround(x: number): number;
    cbrt(x: number): number;

    // GTA III, GTA Vice City, GTA SA commands
    ConvertMetersToFeet(meters: int): int;
    RandomFloatInRange(min: float, max: float): float;
    RandomIntInRange(min: int, max: int): int;

    // GTA Vice City, GTA SA commands
    GetDistanceBetweenCoords2D(fromX: float, fromY: float, toX: float, toZ: float): float;
    GetDistanceBetweenCoords3D(fromX: float, fromY: float, fromZ: float, toX: float, toY: float, toZ: float): float;

    // GTA SA commands
    GetAngleBetween2DVectors(xVector1: float, yVector1: float, xVector2: float, yVector2: float): float;
    GetHeadingFromVector2D(_p1: float, _p2: float): float;
    LimitAngle(value: float): float;
}
</code></pre>
<p>The first group includes the native constants and methods provided by the JavaScript runtime. They start with a lowercase letter, e.g. <code>Math.abs</code>. You can find the detailed documentation for these methods <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math">here</a>.</p>
<p>Then the game-specific commands follow. According to the naming convention, each method that is bound to a script opcode starts with a capital letter, e.g. <code>Math.RandomIntInRange</code> (opcode 0209). You can find the documentation in <a href="https://library.sannybuilder.com/">Sanny Builder Library</a>.</p>
<pre><code class="language-js">    var x = Math.abs(-1); // x = 1
    var f = Math.ConvertMetersToFeet(10) // f = 32
    var pi = Math.floor(Math.PI) // pi = 3
</code></pre>
<p>Native <code>Math</code> methods were given a higher priority over the game commands with the same functionality. For example, to calculate an absolute value of the number, there is <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/abs">Math.abs</a>, not <a href="https://library.sannybuilder.com/#/gta3?q=%22abs%22">Math.Abs</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="memory-object"><a class="header" href="#memory-object">Memory Object</a></h1>
<blockquote>
<p>This guide is for x86 hosts (such as classic era games). For the information on using the Memory class on x64 hosts (such as the Definitive edition) <a href="./using-memory-64.html">click here</a>.</p>
</blockquote>
<ul>
<li><a href="using-memory.html#reading-and-writing-numbers">Reading and Writing Numbers</a></li>
<li><a href="using-memory.html#reading-and-writing-strings">Reading and Writing Strings</a></li>
<li><a href="using-memory.html#casting-methods">Casting methods</a></li>
<li><a href="using-memory.html#calling-foreign-functions">Calling Foreign Functions</a>
<ul>
<li><a href="using-memory.html#convenience-methods-with-fn-object">Convenience methods with Fn object</a></li>
</ul>
</li>
<li><a href="using-memory.html#finding-memory-addresses-in-re3-and-revc">Finding Memory Addresses in re3 and reVC</a></li>
</ul>
<p>An intrinsic object <code>Memory</code> provides methods for accessing and manipulating the data or code in the current process. It has the following interface:</p>
<pre><code class="language-ts">interface Memory {
  ReadFloat(address: int, vp: boolean): float;
  WriteFloat(address: int, value: float, vp: boolean): void;
  ReadI8(address: int, vp: boolean): int;
  ReadI16(address: int, vp: boolean): int;
  ReadI32(address: int, vp: boolean): int;
  ReadU8(address: int, vp: boolean): int;
  ReadU16(address: int, vp: boolean): int;
  ReadU32(address: int, vp: boolean): int;
  ReadUtf8(address: int): string;
  ReadUtf16(address: int): string;
  WriteI8(address: int, value: int, vp: boolean): void;
  WriteI16(address: int, value: int, vp: boolean): void;
  WriteI32(address: int, value: int, vp: boolean): void;
  WriteU8(address: int, value: int, vp: boolean): void;
  WriteU16(address: int, value: int, vp: boolean): void;
  WriteU32(address: int, value: int, vp: boolean): void;
  WriteUtf8(address: int, value: string, vp: boolean): void;
  WriteUtf16(address: int, value: string, vp: boolean): void;
  Read(address: int, size: int, vp: boolean): int;
  Write(address: int, size: int, value: int, vp: boolean): void;

  ToFloat(value: int): float;
  FromFloat(value: float): int;
  ToU8(value: int): int;
  ToU16(value: int): int;
  ToU32(value: int): int;
  ToI8(value: int): int;
  ToI16(value: int): int;
  ToI32(value: int): int;

  Translate(symbol: string): int;

  CallFunction(address: int, numParams: int, pop: int, ...funcParams: int[]): void;
  CallFunctionReturn(address: int, numParams: int, pop: int, ...funcParams: int[]): int;
  CallFunctionReturnFloat(address: int, numParams: int, pop: int, ...funcParams: int[]): float;
  CallMethod(address: int, struct: int, numParams: int, pop: int, ...funcParams: int[]): void;
  CallMethodReturn(address: int, struct: int, numParams: int, pop: int, ...funcParams: int[]): int;
  CallMethodReturnFloat(address: int, struct: int, numParams: int, pop: int, ...funcParams: int[]): float;

  Fn: {
    Cdecl(address: int): (...funcParams: int[]) =&gt; int;
    CdeclFloat(address: int): (...funcParams: int[]) =&gt; float;
    CdeclI8(address: int): (...funcParams: int[]) =&gt; int;
    CdeclI16(address: int): (...funcParams: int[]) =&gt; int;
    CdeclI32(address: int): (...funcParams: int[]) =&gt; int;
    CdeclU8(address: int): (...funcParams: int[]) =&gt; int;
    CdeclU16(address: int): (...funcParams: int[]) =&gt; int;
    CdeclU32(address: int): (...funcParams: int[]) =&gt; int;

    Stdcall(address: int): (...funcParams: int[]) =&gt; int;
    StdcallFloat(address: int): (...funcParams: int[]) =&gt; float;
    StdcallI8(address: int): (...funcParams: int[]) =&gt; int;
    StdcallI16(address: int): (...funcParams: int[]) =&gt; int;
    StdcallI32(address: int): (...funcParams: int[]) =&gt; int;
    StdcallU8(address: int): (...funcParams: int[]) =&gt; int;
    StdcallU16(address: int): (...funcParams: int[]) =&gt; int;
    StdcallU32(address: int): (...funcParams: int[]) =&gt; int;

    Thiscall(address: int, struct: int): (...funcParams: int[]) =&gt; int;
    ThiscallFloat(address: int, struct: int): (...funcParams: int[]) =&gt; float;
    ThiscallI8(address: int, struct: int): (...funcParams: int[]) =&gt; int;
    ThiscallI16(address: int, struct: int): (...funcParams: int[]) =&gt; int;
    ThiscallI32(address: int, struct: int): (...funcParams: int[]) =&gt; int;
    ThiscallU8(address: int, struct: int): (...funcParams: int[]) =&gt; int;
    ThiscallU16(address: int, struct: int): (...funcParams: int[]) =&gt; int;
    ThiscallU32(address: int, struct: int): (...funcParams: int[]) =&gt; int;
  };
}
</code></pre>
<h3 id="reading-and-writing-numbers"><a class="header" href="#reading-and-writing-numbers">Reading and Writing Numbers</a></h3>
<p>A group of memory access methods (<code>ReadXXX</code>/<code>WriteXXX</code>) can be used for reading or modifying numbers stored in the memory. Each method is designed for a particular data type. For example, to change a floating-point number (which occupies 4 bytes in the original game) use <code>Memory.WriteFloat</code>:</p>
<pre><code class="language-js">Memory.WriteFloat(address, 1.0, false);
</code></pre>
<p>where <code>address</code> is a variable storing the memory location, <code>1.0</code> is the value to write and <code>false</code> means it's not necessary to change the memory protection with <code>VirtualProtect</code> (the address is already writable).</p>
<p>Similarly, to read a number from the memory, use one of the <code>ReadXXX</code> methods, depending on what data type the memory address contains. For example, to read a 8-bit signed integer (also known as a <code>char</code> or <code>uint8</code>) use <code>Memory.ReadI8</code>:</p>
<pre><code class="language-js">var x = Memory.ReadI8(address, true);
</code></pre>
<p>variable <code>x</code> now holds a 8-bit integer value in the range (0..255). For the sake of showing possible options, this example uses <code>true</code> as the last argument, which means the default protection attribute for this address will be changed to <code>PAGE_EXECUTE_READWRITE</code> before the read.</p>
<pre><code class="language-js">var gravity = Memory.ReadFloat(gravityAddress, false);
gravity += 0.05;
Memory.WriteFloat(gravityAddress, gravity, false);
</code></pre>
<p>Finally, last two methods <code>Read</code> and <code>Write</code> is what other methods use under the hood. They have direct binding to opcodes <a href="https://library.sannybuilder.com/#/gta3/CLEO/0A8D">0A8D READ_MEMORY</a> and <a href="https://library.sannybuilder.com/#/gta3/CLEO/0A8C">0A8C WRITE_MEMORY</a> and produce the same result.</p>
<p>The <code>size</code> parameter in the <code>Read</code> method can only be <code>1</code>, <code>2</code> or <code>4</code>. CLEO treats the <code>value</code> as a signed integer stored in the little-endian format.</p>
<p>In the <code>Write</code> method any <code>size</code> larger than <code>0</code> is allowed. Sizes <code>3</code> and <code>5</code> onwards can only be used together with a single byte <code>value</code>. CLEO uses them to fill a continious block of memory starting at the <code>address</code> with the given <code>value</code> (think of it as <code>memset</code> in C++).</p>
<pre><code class="language-js">Memory.Write(addr, 0x90, 10, true); // &quot;noping&quot; 10 bytes of code starting from addr
</code></pre>
<blockquote>
<p>The usage of any of the read/write methods requires the <code>mem</code> <a href="./permissions.html">permission</a>.</p>
</blockquote>
<h3 id="reading-and-writing-strings"><a class="header" href="#reading-and-writing-strings">Reading and Writing Strings</a></h3>
<p>The <code>ReadUtf8</code> and <code>ReadUtf16</code> methods are used to read strings from the memory and return it as a JavaScript string. They read the character sequence until the first null terminator is found. <code>ReadUtf8</code> expects the string to be encoded in UTF-8, while <code>ReadUtf16</code> expects UTF-16. Null terminator is not included in the result.</p>
<pre><code class="language-js">var str = Memory.ReadUtf8(address);
var str = Memory.ReadUtf16(address);
</code></pre>
<p>The <code>WriteUtf8</code> and <code>WriteUtf16</code> methods are used to write a JavaScript string to the memory. They write any character sequence including null terminator to the memory. <code>WriteUtf8</code> encodes the string in UTF-8, while <code>WriteUtf16</code> encodes it in UTF-16. Last argument is a boolean value indicating whether the command is allowed to overwrite the memory protection.</p>
<pre><code class="language-js">Memory.WriteUtf8(address, &quot;Hello, world!\0&quot;, true);
Memory.WriteUtf16(address, &quot;Hello, world!\0&quot;, true);
</code></pre>
<h3 id="casting-methods"><a class="header" href="#casting-methods">Casting methods</a></h3>
<p>By default <code>Read</code> and <code>Write</code> methods treat data as signed integer values. It can be inconvinient if the memory holds a floating-point value in IEEE 754 format or a large 32-bit signed integer (e.g. a pointer). In this case use casting methods <code>ToXXX</code>/<code>FromXXX</code>. They act similarly to <a href="https://docs.microsoft.com/en-us/cpp/cpp/reinterpret-cast-operator?view=msvc-160">reinterpret_cast</a> operator in C++.</p>
<p>To get a quick idea what to expect from those methods see the following examples:</p>
<pre><code class="language-js">    Memory.FromFloat(1.0) =&gt; 1065353216
    Memory.ToFloat(1065353216) =&gt; 1.0
    Memory.ToU8(-1) =&gt; 255
    Memory.ToU16(-1) =&gt; 65535
    Memory.ToU32(-1) =&gt; 4294967295
    Memory.ToI8(255) =&gt; -1
    Memory.ToI16(65535) =&gt; -1
    Memory.ToI32(4294967295) =&gt; -1
</code></pre>
<p>Alternatively, use appropriate methods to read/write the value as a float (<code>ReadFloat</code>/<code>WriteFloat</code>) or as an unsigned integer (<code>ReadUXXX</code>/<code>WriteUXXX</code>).</p>
<h3 id="calling-foreign-functions"><a class="header" href="#calling-foreign-functions">Calling Foreign Functions</a></h3>
<p><code>Memory</code> object allows to invoke a foreign (native) function by its address using one of the following methods:</p>
<ul>
<li>
<p><code>Memory.CallFunction</code> - calls a function at the address and discards the returned value</p>
</li>
<li>
<p><code>Memory.CallFunctionReturn</code> - calls a function and at the address and returns an integer value</p>
</li>
<li>
<p><code>Memory.CallFunctionReturnFloat</code> - calls a function and at the address and returns a floating-point value</p>
</li>
<li>
<p><code>Memory.CallMethod</code> - calls a class instance method and discards the returned value</p>
</li>
<li>
<p><code>Memory.CallMethodReturn</code> - calls a class instance method and returns an integer value</p>
</li>
<li>
<p><code>Memory.CallMethodReturnFloat</code> - calls a class instance method and returns a floating-point value</p>
</li>
</ul>
<pre><code class="language-js">Memory.CallFunction(0x1234567, 2, 0, 1000, 2000);
</code></pre>
<p>where <code>0x1234567</code> is the address of the function, <code>2</code> is the number of arguments, <code>0</code> is the <code>pop</code> parameter (see below), <code>1000</code> and <code>2000</code> are the two arguments passed into the function.</p>
<blockquote>
<p>Legacy SCM implementation of the call commands require the arguments of the invoked function to be listed in reverse order. That's it, you would see the same call in SCM as:</p>
<pre><code>0AA5: call 0x1234567 num_params 2 pop 0 2000 1000
</code></pre>
<p>where <code>2000</code> is the second argument passed to the function located at 0x1234567 and <code>1000</code> is the first one. In JS code all input arguments go in the direct order.</p>
</blockquote>
<p>The third parameter (<code>pop</code>) in <code>Memory.CallFunction</code> defines the calling convention. When it is set to <code>0</code>, the function is called using the <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#stdcall">stdcall</a> convention. When it is set to the same value as <code>numParam</code>, the function is called using the <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cdecl">cdecl</a> convention. Any other value breaks the code.</p>
<p><code>Memory.CallFunctionReturn</code> has the same interface but additionally it writes the result of the function to a variable.</p>
<p><code>Memory.CallMethod</code> invokes a method of an object:</p>
<pre><code class="language-js">Memory.CallMethod(0x2345678, 0x7001234, 2, 0, 1000, 2000);
</code></pre>
<p>The second parameter (<code>0x7001234</code>) is the object address. The <code>pop</code> parameter is always <code>0</code> (the method uses the <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#thiscall">thiscall</a> convention).</p>
<p>To call the method and get the result out of it, use <code>Memory.CallMethodReturn</code>.</p>
<blockquote>
<p>Input arguments are treated as 32-bit signed integers. If you need to provide a floating-point number, use <code>Memory.FromFloat</code>, e.g.</p>
<pre><code class="language-js">Memory.CallFunction(0x1234567, 1, 1, Memory.FromFloat(123.456));
</code></pre>
</blockquote>
<p>CLEO Redux supports calling foreign functions with up to 16 parameters.</p>
<blockquote>
<p>The usage of any of the call methods requires the <code>mem</code> <a href="./permissions.html">permission</a>.</p>
</blockquote>
<h4 id="convenience-methods-with-fn-object"><a class="header" href="#convenience-methods-with-fn-object">Convenience methods with Fn object</a></h4>
<p><code>Memory.Fn</code> provides a lot of convenient methods for calling different types of foreign functions.</p>
<pre><code class="language-ts">Fn: {
        Cdecl(address: int): (...funcParams: int[]) =&gt; int;
        CdeclFloat(address: int): (...funcParams: int[]) =&gt; float;
        CdeclI8(address: int): (...funcParams: int[]) =&gt; int;
        CdeclI16(address: int): (...funcParams: int[]) =&gt; int;
        CdeclI32(address: int): (...funcParams: int[]) =&gt; int;
        CdeclU8(address: int): (...funcParams: int[]) =&gt; int;
        CdeclU16(address: int): (...funcParams: int[]) =&gt; int;
        CdeclU32(address: int): (...funcParams: int[]) =&gt; int;

        Stdcall(address: int): (...funcParams: int[]) =&gt; int;
        StdcallFloat(address: int): (...funcParams: int[]) =&gt; float;
        StdcallI8(address: int): (...funcParams: int[]) =&gt; int;
        StdcallI16(address: int): (...funcParams: int[]) =&gt; int;
        StdcallI32(address: int): (...funcParams: int[]) =&gt; int;
        StdcallU8(address: int): (...funcParams: int[]) =&gt; int;
        StdcallU16(address: int): (...funcParams: int[]) =&gt; int;
        StdcallU32(address: int): (...funcParams: int[]) =&gt; int;

        Thiscall(address: int, struct: int): (...funcParams: int[]) =&gt; int;
        ThiscallFloat(address: int, struct: int): (...funcParams: int[]) =&gt; float;
        ThiscallI8(address: int, struct: int): (...funcParams: int[]) =&gt; int;
        ThiscallI16(address: int, struct: int): (...funcParams: int[]) =&gt; int;
        ThiscallI32(address: int, struct: int): (...funcParams: int[]) =&gt; int;
        ThiscallU8(address: int, struct: int): (...funcParams: int[]) =&gt; int;
        ThiscallU16(address: int, struct: int): (...funcParams: int[]) =&gt; int;
        ThiscallU32(address: int, struct: int): (...funcParams: int[]) =&gt; int;
    }
</code></pre>
<p>These methods is designed to cover all possible function signatures. For example, this code</p>
<pre><code class="language-js">Memory.CallMethod(0x2345678, 0x7001234, 2, 0, 1000, 2000);
</code></pre>
<p>can also be written as</p>
<pre><code class="language-js">Memory.Fn.Thiscall(0x2345678, 0x7001234)(1000, 2000);
</code></pre>
<p>Note a few key differences here. First of all, <code>Memory.Fn</code> methods don't invoke a foreign function directly. Instead, they return a new JavaScript function that can be stored in a variable and reused to call the associated foreign function many times with different arguments:</p>
<pre><code class="language-js">var myMethod = Memory.Fn.Thiscall(0x2345678, 0x7001234);
myMethod(1000, 2000); // calls method 0x2345678 with arguments 1000 and 2000
myMethod(3000, 5000); // calls method 0x2345678 with arguments 3000 and 5000
</code></pre>
<p>The second difference is that there are no <code>numParams</code> and <code>pop</code> parameters. Each <code>Fn</code> method figures them out automatically.</p>
<p>By default a returned result is considered a 32-bit signed integer value. If the function returns another type (a floating-point value, or a signed integer), use one of the methods matching the function signature, e.g.:</p>
<pre><code class="language-js">var flag = Memory.Fn.CdeclU8(0x1234567)();
</code></pre>
<p>This code invokes a <code>cdecl</code> function at <code>0x1234567</code> with no arguments and stores the result as a 8-bit unsigned integer value.</p>
<h3 id="finding-memory-addresses-in-re3-and-revc"><a class="header" href="#finding-memory-addresses-in-re3-and-revc">Finding Memory Addresses in re3 and reVC</a></h3>
<p>Since <code>re3</code> and <code>reVC</code> use address space layout randomization (ASLR) feature, it can be difficult to locate needed addresses. CLEO Redux provides a helper function <code>Memory.Translate</code> that accepts a name of the function or variable and returns its current address. If the requested symbol is not found, the result is 0.</p>
<pre><code class="language-js">var addr = Memory.Translate(&quot;CTheScripts::MainScriptSize&quot;);

// check if address is not zero
if (addr) {
  showTextBox(&quot;MainScriptSize = &quot; + Memory.ReadI32(addr, 0));
}
</code></pre>
<p>At the moment <code>Memory.Translate</code> should only be used in <code>re3</code> and <code>reVC</code>. In other games you will be getting <code>0</code> as a result most of the time.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="memory-object-x64"><a class="header" href="#memory-object-x64">Memory Object (x64)</a></h1>
<blockquote>
<p>This guide is for x64 hosts (e.g. the remastered trilogy). For the information on using the Memory class on x86 (classic era games) <a href="./using-memory.html">click here</a>.</p>
</blockquote>
<ul>
<li><a href="using-memory-64.html#reading-and-writing-numbers">Reading and Writing Numbers</a></li>
<li><a href="using-memory-64.html#reading-and-writing-strings">Reading and Writing Strings</a></li>
<li><a href="using-memory-64.html#casting-methods">Casting methods</a></li>
<li><a href="using-memory-64.html#calling-foreign-functions">Calling Foreign Functions</a>
<ul>
<li><a href="using-memory-64.html#convenience-methods-with-fn-object">Convenience methods with Fn object</a></li>
</ul>
</li>
</ul>
<p>An intrinsic object <code>Memory</code> provides methods for accessing and manipulating the data or code in the current process. It has the following interface:</p>
<pre><code class="language-ts">interface Memory {
  ReadFloat(address: int, vp: boolean, ib: boolean): float;
  WriteFloat(address: int, value: float, vp: boolean, ib: boolean): void;
  ReadI8(address: int, vp: boolean, ib: boolean): int;
  ReadI16(address: int, vp: boolean, ib: boolean): int;
  ReadI32(address: int, vp: boolean, ib: boolean): int;
  ReadU8(address: int, vp: boolean, ib: boolean): int;
  ReadU16(address: int, vp: boolean, ib: boolean): int;
  ReadU32(address: int, vp: boolean, ib: boolean): int;
  ReadUtf8(address: int, ib: boolean): string;
  ReadUtf16(address: int, ib: boolean): string;
  WriteI8(address: int, value: int, vp: boolean, ib: boolean): void;
  WriteI16(address: int, value: int, vp: boolean, ib: boolean): void;
  WriteI32(address: int, value: int, vp: boolean, ib: boolean): void;
  WriteU8(address: int, value: int, vp: boolean, ib: boolean): void;
  WriteU16(address: int, value: int, vp: boolean, ib: boolean): void;
  WriteU32(address: int, value: int, vp: boolean, ib: boolean): void;
  WriteUtf8(address: int, value: string, vp: boolean, ib: boolean): void;
  WriteUtf16(address: int, value: string, vp: boolean, ib: boolean): void;
  Read(address: int, size: int, vp: boolean, ib: boolean): int;
  Write(address: int, size: int, value: int, vp: boolean, ib: boolean): void;

  ToFloat(value: int): float;
  FromFloat(value: float): int;
  ToU8(value: int): int;
  ToU16(value: int): int;
  ToU32(value: int): int;
  ToI8(value: int): int;
  ToI16(value: int): int;
  ToI32(value: int): int;

  CallFunction(address: int, ib: boolean, numParams: int, ...funcParams: int[]): void;
  CallFunctionReturn(address: int, ib: boolean, numParams: int, ...funcParams: int[]): int;
  CallFunctionReturnFloat(address: int, ib: boolean, numParams: int, ...funcParams: int[]): float;

  Fn: {
    X64(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
    X64Float(address: int, ib: boolean): (...funcParams: int[]) =&gt; float;
    X64I8(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
    X64I16(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
    X64I32(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
    X64U8(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
    X64U16(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
    X64U32(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
  };
}
</code></pre>
<h3 id="reading-and-writing-numbers-1"><a class="header" href="#reading-and-writing-numbers-1">Reading and Writing Numbers</a></h3>
<p>A group of memory access methods (<code>ReadXXX</code>/<code>WriteXXX</code>) can be used for reading or modifying numbers stored in the memory. Each method is designed for a particular data type. For example, to change a floating-point number (which occupies 4 bytes in the original game) use <code>Memory.WriteFloat</code>:</p>
<pre><code class="language-js">Memory.WriteFloat(address, 1.0, false, false);
</code></pre>
<p>where <code>address</code> is a variable storing the memory location, <code>1.0</code> is the value to write, the first <code>false</code> means it's not necessary to change the memory protection with <code>VirtualProtect</code> (the address is already writable). The second <code>false</code> is the value of the <code>ib</code> flag that instructs CLEO to treat the <code>address</code> either as an absolute address (<code>ib</code> = <code>false</code>) or a relative offset to the current image base address (<code>ib</code> = <code>true</code>). Due to an ASLR feature memory addresses could change when the game runs because the base address changes. Consider the following example:</p>
<pre><code>0x1400000000 ImageBase
...
...
0x1400000020 SomeValue
</code></pre>
<p>You want to change <code>SomeValue</code> that is currently located at <code>0x1400000020</code>. You can do it with <code>Memory.Write(0x1400000020, 1, 1, false, false)</code>. However on the next game run the memory layout might look like this:</p>
<pre><code>0x1500000000 ImageBase
...
...
0x1500000020 SomeValue
</code></pre>
<p>effectively breaking the script. In this case, calculate a relative offset from the image base ( <code>0x1500000020</code> - <code>0x1500000000</code> = <code>0x20</code> ), that will be permanent for the particular game version. Use <code>Memory.Write</code> as follows: <code>Memory.Write(0x20, 1, 1, false, true)</code>. CLEO will sum up the offset (<code>0x20</code>) with the current value of the image base (<code>0x1400000000</code>, <code>0x1500000000</code>, etc) and write to the correct absolute address.</p>
<p>For your convenience you can find the current value of the image base in the <code>cleo_redux.log</code>, e.g.:</p>
<pre><code>09:27:35 [INFO] Image base address 0x7ff7d1f50000
</code></pre>
<p>Similarly, to read a value from the memory, use one of the <code>ReadXXX</code> methods, depending on what data type the memory address contains. For example, to read a 8-bit signed integer (also known as a <code>char</code> or <code>uint8</code>) use <code>Memory.ReadI8</code>:</p>
<pre><code class="language-js">var x = Memory.ReadI8(offset, true, true);
</code></pre>
<p>variable <code>x</code> now holds a 8-bit integer value in the range (0..255). For the sake of showing possible options, this example uses <code>true</code> as the last argument, which means the default protection attribute for this address will be changed to <code>PAGE_EXECUTE_READWRITE</code> before the read.</p>
<pre><code class="language-js">var gravity = Memory.ReadFloat(gravityOffset, false, true);
gravity += 0.05;
Memory.WriteFloat(gravityOffset, gravity, false, true);
</code></pre>
<p>Finally, last two methods <code>Read</code> and <code>Write</code> is what other methods use under the hood. They have direct binding to the Rust code that reads and write the memory. In JavaScript code you can use input arguments as large as 53-bit numbers.</p>
<p>The <code>size</code> parameter in the <code>Read</code> method can only be <code>1</code>, <code>2</code>, <code>4</code> or <code>8</code>. CLEO treats the <code>value</code> as a signed integer stored in the little-endian format.</p>
<p>In the <code>Write</code> method any <code>size</code> larger than <code>0</code> is allowed. Sizes <code>3</code>, <code>5</code>, <code>6</code>, <code>7</code> and <code>9</code> onwards can only be used together with a single byte <code>value</code>. CLEO uses them to fill a continious block of memory starting at the <code>address</code> with the given <code>value</code> (think of it as <code>memset</code> in C++).</p>
<pre><code class="language-js">Memory.Write(offset, 0x90, 10, true, true); // &quot;noping&quot; 10 bytes of code starting from offset+image base
</code></pre>
<blockquote>
<p>The usage of any of the read/write methods requires the <code>mem</code> <a href="./permissions.html">permission</a>.</p>
</blockquote>
<h3 id="reading-and-writing-strings-1"><a class="header" href="#reading-and-writing-strings-1">Reading and Writing Strings</a></h3>
<p>The <code>ReadUtf8</code> and <code>ReadUtf16</code> methods are used to read strings from the memory and return it as a JavaScript string. They read a character sequence until the first null terminator is found. <code>ReadUtf8</code> expects the string to be encoded in UTF-8, while <code>ReadUtf16</code> expects UTF-16. Null terminator is not included in the result. Last argument <code>ib</code> indicates whethers the <code>address</code> is an absolute address or a relative offset to the image base.</p>
<pre><code class="language-js">var str = Memory.ReadUtf8(0x100000, false); // read string from address 0x100000
var str = Memory.ReadUtf8(0x100000, true); // read string from address 0x100000+IMAGE_BASE
</code></pre>
<p>The <code>WriteUtf8</code> and <code>WriteUtf16</code> methods are used to write a JavaScript string to the memory. They write any character sequence including null terminator to the memory. <code>WriteUtf8</code> encodes the string in UTF-8, while <code>WriteUtf16</code> encodes it in UTF-16. Third argument is a boolean value indicating whether the command is allowed to overwrite the memory protection. Last argument <code>ib</code> indicates whethers the <code>address</code> is an absolute address or a relative offset to the image base.</p>
<pre><code class="language-js">Memory.WriteUtf8(0x100000, &quot;Hello, world!\0\0&quot;, true, false); // write string to address 0x100000
Memory.WriteUtf8(0x100000, &quot;Hello, world!\0\0&quot;, true, true); // write string to address 0x100000+IMAGE_BASE
</code></pre>
<h3 id="casting-methods-1"><a class="header" href="#casting-methods-1">Casting methods</a></h3>
<p>By default <code>Read</code> and <code>Write</code> methods treat data as signed integer values. It can be inconvinient if the memory holds a floating-point value in IEEE 754 format or a large 32-bit signed integer (e.g. a pointer). In this case use casting methods <code>ToXXX</code>/<code>FromXXX</code>. They act similarly to <a href="https://docs.microsoft.com/en-us/cpp/cpp/reinterpret-cast-operator?view=msvc-160">reinterpret_cast</a> operator in C++.</p>
<p>To get a quick idea what to expect from those methods see the following examples:</p>
<pre><code class="language-js">    Memory.FromFloat(1.0) =&gt; 1065353216
    Memory.ToFloat(1065353216) =&gt; 1.0
    Memory.ToU8(-1) =&gt; 255
    Memory.ToU16(-1) =&gt; 65535
    Memory.ToU32(-1) =&gt; 4294967295
    Memory.ToI8(255) =&gt; -1
    Memory.ToI16(65535) =&gt; -1
    Memory.ToI32(4294967295) =&gt; -1
</code></pre>
<p>Alternatively, use appropriate methods to read/write the value as a float (<code>ReadFloat</code>/<code>WriteFloat</code>) or as an unsigned integer (<code>ReadUXXX</code>/<code>WriteUXXX</code>).</p>
<h3 id="calling-foreign-functions-1"><a class="header" href="#calling-foreign-functions-1">Calling Foreign Functions</a></h3>
<p><code>Memory</code> object allows to invoke a foreign (native) function by its address using one of the following methods:</p>
<ul>
<li><code>Memory.CallFunction</code> - calls a function at the address and discards the returned value</li>
<li><code>Memory.CallFunctionReturn</code> - calls a function and at the address and returns an integer value</li>
<li><code>Memory.CallFunctionReturnFloat</code> - calls a function and at the address and returns a floating-point value</li>
</ul>
<pre><code class="language-js">Memory.CallFunction(0xeffb30, true, 1, 13);
</code></pre>
<p>where <code>0xEFFB30</code> is the function offset relative to IMAGE BASE (think of it a randomized start address of the game memory), <code>true</code> is the <code>ib</code> flag (see below), <code>1</code> is the number of input arguments, and <code>13</code> are the only argument passed into the function.</p>
<p>The <code>ib</code> parameter in <code>Memory.CallFunction</code> has the same meaning as in memory read/write commands. When set to <code>true</code> CLEO adds the current known address of the image base to the value provided as the first argument to calculate the absolute memory address of the function. When set to <code>false</code> no changes to the first argument are made.</p>
<blockquote>
<p>To pass floating-point values to the function, convert the value to integer using <code>Memory.FromFloat</code>:</p>
<pre><code class="language-js">Memory.CallFunction(0x1234567, true, 1, Memory.FromFloat(123.456));
</code></pre>
</blockquote>
<p>A returned value of the function called with <code>Memory.CallFunction</code> is ignored. To read the result use <code>Memory.CallFunctionReturn</code> that has the same parameters. Use <code>Memory.CallFunctionReturnFloat</code> to call a function that returns a floating-point value.</p>
<p>CLEO Redux supports calling foreign functions with up to 16 parameters.</p>
<blockquote>
<p>The usage of any of the call methods requires the <code>mem</code> <a href="./permissions.html">permission</a>.</p>
</blockquote>
<h4 id="convenience-methods-with-fn-object-1"><a class="header" href="#convenience-methods-with-fn-object-1">Convenience methods with Fn object</a></h4>
<p><code>Memory.Fn</code> provides convenient methods for calling different types of foreign functions.</p>
<pre><code class="language-ts">    Fn: {
        X64(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
        X64Float(address: int, ib: boolean): (...funcParams: int[]) =&gt; float;
        X64I8(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
        X64I16(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
        X64I32(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
        X64U8(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
        X64U16(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
        X64U32(address: int, ib: boolean): (...funcParams: int[]) =&gt; int;
    }
</code></pre>
<p>These methods is designed to cover all supported return types. For example, this code</p>
<pre><code class="language-js">Memory.CallFunction(0xeffb30, true, 1, 13);
</code></pre>
<p>can also be written as</p>
<pre><code class="language-js">Memory.Fn.X64(0xeffb30, true)(13);
</code></pre>
<p>Note a few key differences here. First of all, <code>Memory.Fn</code> methods don't invoke a foreign function directly. Instead, they return a new JavaScript function that can be stored in a variable and reused to call the associated foreign function many times with different arguments:</p>
<pre><code class="language-js">var f = Memory.Fn.X64(0xeffb30, true);
f(13); // calls function 0xEFFB30 with the argument of 13
f(11); // calls method 0xEFFB30 with the argument of 11
</code></pre>
<p>The second difference is that there is no <code>numParams</code> parameter. Each <code>Fn</code> method figures it out automatically.</p>
<p>By default a returned result is considered a 64-bit signed integer value. If the function returns another type (e.g. a boolean), use one of the methods matching the function signature:</p>
<pre><code class="language-js">var flag = Memory.Fn.X64U8(0x1234567, true)();
</code></pre>
<p>This code invokes a function at <code>0x1234567</code> + IMAGE_BASE with no arguments and stores the result as a 8-bit unsigned integer value.</p>
<pre><code class="language-js">var float = Memory.Fn.X64Float(0x456789, true)();
</code></pre>
<p>This code invokes a function at <code>0x456789</code> + IMAGE_BASE with no arguments and stores the result as a floating-point value.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deprecated"><a class="header" href="#deprecated">Deprecated</a></h1>
<p>Usage of the following commands is not recommended.</p>
<h2 id="game"><a class="header" href="#game">GAME</a></h2>
<p><code>GAME</code> variable has been renamed to <a href="./api.html#host">HOST</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="typescript"><a class="header" href="#typescript">TypeScript</a></h1>
<p>CLEO Redux has first-class support for TypeScript. TypeScript is a superset of JavaScript with static types and other features. It is compiled to JavaScript and can be efficiently used in large-scale projects. TypeScript has excellent IDE support so you get autocompletion, type checking and other features in your editor for free.</p>
<p>TypeScript website: <a href="https://www.typescriptlang.org/">https://www.typescriptlang.org/</a>.</p>
<p>TS scripts have <code>.ts</code> extension and can be used anywhere <a href="./script-lifecycle.html">where JS scripts are supported</a>. They can be imported directly in both JS and TS scripts using <a href="./imports.html"><code>import</code></a> statements.</p>
<h2 id="ts-config"><a class="header" href="#ts-config">TS Config</a></h2>
<p>CLEO Redux creates <code>tsconfig.json</code> file in the <a href="./cleo-directory.html">CLEO directory</a> when you run it for the first time. It contains necessary information for VS Code and other IDEs on where to look for typing files, so you don't have to include <code>/// &lt;reference path=&quot;...&quot; /&gt;</code> lines in your scripts. You can edit it to change the default settings.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h1>
<ul>
<li><a href="troubleshooting.html#cleo-does-not-work-with-re3-or-revc">CLEO does not work with re3 or reVC</a></li>
<li><a href="troubleshooting.html#game-crashes-with-cleo-on-san-andreas-the-definitive-edition">Game crashes with CLEO on San Andreas: The Definitive Edition</a></li>
<li><a href="troubleshooting.html#scripts-stopped-working-after-cleo-redux-update">Scripts stopped working after CLEO Redux update</a></li>
<li><a href="troubleshooting.html#game-is-stuck-loading">Game is stuck loading</a></li>
<li><a href="troubleshooting.html#nothing-happens-when-i-run-the-game-not-even-a-log-file-is-there">Nothing happens when I run the game, not even a log file is there</a></li>
<li><a href="troubleshooting.html#my-problem-is-not-listed-there">My problem is not listed there</a></li>
</ul>
<h2 id="cleo-does-not-work-with-re3-or-revc"><a class="header" href="#cleo-does-not-work-with-re3-or-revc">CLEO does not work with re3 or reVC</a></h2>
<p>CLEO Redux supports &quot;Windows D3D9&quot; version of <code>re3</code> or <code>reVC</code> (both 32-bit and 64-bit).</p>
<p>During installation you must select the correct version of <code>re3</code> or <code>reVC</code>: either 32-bit or 64-bit.</p>
<p>When running on <code>re3</code> and <code>reVC</code> make sure the game directory contains the file <code>re3.pdb</code> (for <strong>re3</strong>) or <code>reVC.pdb</code> (for <strong>reVC</strong>). Due to the dynamic nature of memory addresses in those implementations CLEO Redux relies on debug information stored in the PDB file to correctly locate itself.</p>
<h2 id="game-crashes-with-cleo-on-san-andreas-the-definitive-edition"><a class="header" href="#game-crashes-with-cleo-on-san-andreas-the-definitive-edition">Game crashes with CLEO on San Andreas: The Definitive Edition</a></h2>
<ul>
<li>make sure you installed the 64-bit version of Ultimate ASI Loader (<a href="https://github.com/ThirteenAG/Ultimate-ASI-Loader/releases/download/x64-latest/version.zip">direct link to the latest release</a>).
<ul>
<li>Put <code>version.dll</code> to <code>Gameface\Binaries\Win64</code></li>
</ul>
</li>
<li>make sure you run the latest CLEO Redux version (0.8.2 and above)</li>
<li>delete config files from <code>Documents\Rockstar Games\GTA San Andreas Definitive Edition\Config\WindowsNoEditor</code></li>
<li>run the game (or Rockstar Games Launcher) as administrator</li>
</ul>
<p>If CLEO can't create files in <code>Gameface\Binaries\Win64</code> it uses another path at <code>C:\Users\&lt;your_usename&gt;\AppData\Roaming\CLEO Redux</code>. There should be <code>cleo_redux.log</code> and the CLEO folder where all your scripts go.</p>
<h2 id="scripts-stopped-working-after-cleo-redux-update"><a class="header" href="#scripts-stopped-working-after-cleo-redux-update">Scripts stopped working after CLEO Redux update</a></h2>
<p>In rare cases there might be an error in command definitions in Sanny Builder Library. Delete the <a href="./definitions.html">definition file</a> from the <code>.config</code> folder and restart the game. CLEO will redownload the latest version of the file. If the problem persists, report the issue using links below.</p>
<h2 id="game-is-stuck-loading"><a class="header" href="#game-is-stuck-loading">Game is stuck loading</a></h2>
<p>If the last entry in <a href="./log.html">cleo_redux.log</a> is &quot;Checking for updates...&quot; CLEO can't access GitHub API. It might a temporary issue or your IP address is blocked from GitHub. Open <a href="./config.html">cleo.ini</a>, change <code>CheckUpdates</code> to <code>0</code> and restart the game.</p>
<h2 id="nothing-happens-when-i-run-the-game-not-even-a-log-file-is-there"><a class="header" href="#nothing-happens-when-i-run-the-game-not-even-a-log-file-is-there">Nothing happens when I run the game, not even a log file is there</a></h2>
<p>Check that you have installed Ultimate ASI Loader correctly. Sometimes you might need to give its dll file another name for the game to load it. Refer to <a href="./installation.html#dependency-on-asi-loader">this documentation</a>.</p>
<h2 id="my-problem-is-not-listed-there"><a class="header" href="#my-problem-is-not-listed-there">My problem is not listed there</a></h2>
<ul>
<li>Check the <a href="https://github.com/cleolibrary/CLEO-Redux/issues">GitHub tickets</a></li>
<li>Check the <a href="https://github.com/cleolibrary/CLEO-Redux/wiki/Feature-Support-Matrix">Feature support page</a></li>
<li>Ask a question in <a href="https://discord.gg/d5dZSfgBZr">our Discord</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="log-1"><a class="header" href="#log-1">Log</a></h1>
<p>CLEO logs important events and errors immediately as they occur in the <code>cleo_redux.log</code> file located in the game directory.</p>
<blockquote>
<p>If CLEO fails to create new files in the game directory due to the lack of write permissions, it fallbacks to using alternate path at <code>C:\Users\&lt;your_username&gt;\AppData\Roaming\CLEO Redux</code>. <code>cleo_redux.log</code> and the <code>CLEO</code> directory can be found there.</p>
</blockquote>
<p>The log file gets overwritten on each game run. If you experience any issue when using CLEO Redux, start investigating the root cause from this file.</p>
<p>To stream events in your terminal while testing a script, run:</p>
<pre><code>tail -f cleo_redux.log
</code></pre>
<p><code>tail</code> is a unix command so a compatible environment is needed (for example <a href="https://git-scm.com/downloads">Git Bash</a>).</p>
<p>For windows users using powershell, run:</p>
<pre><code>Get-Content cleo_redux.log -Wait -Tail 0
</code></pre>
<p>The log file also lists all executed opcodes with <a href="./config.html#general"><code>LogOpcodes=1</code></a> and JavaScript commands with <a href="./api.html#cleo"><code>CLEO.debug.trace(true)</code></a>. </p>
<div style="break-before: page; page-break-before: always;"></div><p>Here you can find answers to the frequently asked questions about support for The Trilogy remaster.</p>
<ul>
<li><a href="the-definitive-edition-faq.html#what-versions-are-supported">What versions are supported?</a></li>
<li><a href="the-definitive-edition-faq.html#is-there-any-difference-from-support-of-the-classic-games">Is there any difference from support of the classic games?</a></li>
<li><a href="the-definitive-edition-faq.html#can-i-use-original-opcodes">Can I use original opcodes?</a></li>
<li><a href="the-definitive-edition-faq.html#how-do-i-know-what-commands-can-i-use-in-javascript">How do I know what commands can I use in JavaScript?</a></li>
<li><a href="the-definitive-edition-faq.html#can-i-use-cleo-opcodes">Can I use CLEO opcodes?</a></li>
<li><a href="the-definitive-edition-faq.html#can-i-work-with-the-game-memory-or-call-the-game-functions">Can I work with the game memory or call the game functions?</a></li>
<li><a href="the-definitive-edition-faq.html#how-do-i-compile-cleo-scripts-with-sanny-builder">How do I compile CLEO scripts with Sanny Builder?</a></li>
<li><a href="the-definitive-edition-faq.html#i-cant-find-an-answer-to-my-question-here-where-do-i-go">I can't find an answer to my question here, where do I go?</a></li>
</ul>
<h3 id="what-versions-are-supported"><a class="header" href="#what-versions-are-supported">What versions are supported?</a></h3>
<table><thead><tr><th>Game\Platform</th><th>Rockstar Games (RGL)</th><th>Steam</th><th>Epic Games</th></tr></thead><tbody>
<tr><td>GTA III: The Definitive Edition</td><td>1.0.0.14718 (Title Update 1.03)<br>1.0.0.15284 (Title Update 1.04)<br>1.0.8.11827 (Title Update 1.04.5)<br>1.0.17.38838<br>1.0.17.39540<br>1.0.112.6680</td><td>1.0.17.38838<br>1.0.17.39540<br>1.0.112.6680<br>1.0.113.21181</td><td>1.0.17.39540</td></tr>
<tr><td>GTA Vice City: The Definitive Edition</td><td>1.0.0.14718 (Title Update 1.03)<br>1.0.0.15399 (Title Update 1.04)<br>1.0.8.11827 (Title Update 1.04.5)<br>1.0.17.38838<br>1.0.17.39540<br>1.0.112.6680</td><td>1.0.17.38838<br>1.0.17.39540<br>1.0.112.6680<br>1.0.113.21181</td><td>1.0.17.39540</td></tr>
<tr><td>San Andreas: The Definitive Edition</td><td>1.0.0.14296<br>1.0.0.14388<br>1.0.0.14718 (Title Update 1.03)<br>1.0.0.15483 (Title Update 1.04)<br>1.0.8.11827 (Title Update 1.04.5)<br>1.0.17.38838<br>1.0.17.39540<br>1.0.112.6680</td><td>1.0.17.38838<br>1.0.17.39540<br>1.0.112.6680<br>1.0.113.21181</td><td>1.0.17.39540</td></tr>
</tbody></table>
<h3 id="is-there-any-difference-from-support-of-the-classic-games"><a class="header" href="#is-there-any-difference-from-support-of-the-classic-games">Is there any difference from support of the classic games?</a></h3>
<p>In short, yes. <a href="https://github.com/cleolibrary/CLEO-Redux/wiki/Feature-Support-Matrix">See this page</a> for detail on what's supported and what's not.</p>
<h3 id="can-i-use-original-opcodes"><a class="header" href="#can-i-use-original-opcodes">Can I use original opcodes?</a></h3>
<p>Yes, you can. Refer to the <a href="https://library.sannybuilder.com/#/sa_unreal">Sanny Builder library</a>. Keep in mind that some opcodes have been changed from the classic games, so don't expect everything to work like it was in classic. If you run into an issue, find help in <a href="https://discord.gg/d5dZSfgBZr">our Discord</a>.</p>
<h3 id="how-do-i-know-what-commands-can-i-use-in-javascript"><a class="header" href="#how-do-i-know-what-commands-can-i-use-in-javascript">How do I know what commands can I use in JavaScript?</a></h3>
<p>After each game run, CLEO generates a <code>.d.ts</code> file in the <code>CLEO\.config</code> directory. It's called <code>gta3.d.ts</code>, <code>vc.d.ts</code> or <code>sa.d.ts</code> depending on the game. This file lists all supported functions and methods that you can use in JavaScript code.</p>
<p>To enable autocomplete in VS Code save your script file with <code>.ts</code> extension.</p>
<h3 id="can-i-use-cleo-opcodes"><a class="header" href="#can-i-use-cleo-opcodes">Can I use CLEO opcodes?</a></h3>
<p>Opcodes from CLEO Library (CLEO 4 or CLEO for GTA III and Vice City) are not supported. But CLEO Redux adds its own new opcodes for some operations.</p>
<ul>
<li>0C00 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C00">IS_KEY_PRESSED</a></li>
<li>0C01 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C01">INT_ADD</a></li>
<li>0C02 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C02">INT_SUB</a></li>
<li>0C03 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C03">INT_MUL</a></li>
<li>0C04 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C04">INT_DIV</a></li>
<li>0C05 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C05">TERMINATE_THIS_CUSTOM_SCRIPT</a></li>
<li>0C06 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C06">WRITE_MEMORY</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
<li>0C07 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C07">READ_MEMORY</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
<li>0C08 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C08">CALL_FUNCTION</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
<li>0C09 <a href="https://library.sannybuilder.com/#/sa_unreal/CLEO/0C09">CALL_FUNCTION_RETURN</a> (<strong>UNSAFE</strong> - requires <code>mem</code> permission)</li>
</ul>
<p>Note that Sanny Builder does not support these new opcodes out-of-the-box yet. To enable new opcodes in your CS scripts add the following lines on top of your script:</p>
<pre><code>{$O 0C00=1,  is_key_pressed %1d% }
{$O 0C01=3,%3d% = %1d% + %2d% }
{$O 0C02=3,%3d% = %1d% - %2d% }
{$O 0C03=3,%3d% = %1d% * %2d% }
{$O 0C04=3,%3d% = %1d% / %2d% }
{$O 0C05=0,terminate_this_custom_script }
{$O 0C06=5,write_memory %1d% size %2d% value %3d% virtual_protect %4d% ib %5d% }
{$O 0C07=5,%5d% = read_memory %1d% size %2d% virtual_protect %3d% ib %4d% }
{$O 0C08=-1,call_function %1d% ib %2d% num_params %3d%}
{$O 0C09=-1,call_function_return %1d% ib %2d% num_params %3d%}
</code></pre>
<p>This list might not be complete as there are custom plugins with extra commands (see <a href="./using-sdk.html">Using SDK</a>). Refer to <a href="https://library.sannybuilder.com">Sanny Builder Library</a> for the complete list of available commands for each game.</p>
<h3 id="can-i-work-with-the-game-memory-or-call-the-game-functions"><a class="header" href="#can-i-work-with-the-game-memory-or-call-the-game-functions">Can I work with the game memory or call the game functions?</a></h3>
<p>Yes, check the <a href="using-memory-64.html">Memory guide</a>.</p>
<h3 id="how-do-i-compile-cleo-scripts-with-sanny-builder"><a class="header" href="#how-do-i-compile-cleo-scripts-with-sanny-builder">How do I compile CLEO scripts with Sanny Builder?</a></h3>
<p>Use SA Mobile mode to compile CLEO scripts for San Andreas: The Definitive Edition. Note that CLEO Redux does not support CS scripts in GTA III: DE and VC: DE. JS scripts are supported in all games.</p>
<h3 id="i-cant-find-an-answer-to-my-question-here-where-do-i-go"><a class="header" href="#i-cant-find-an-answer-to-my-question-here-where-do-i-go">I can't find an answer to my question here, where do I go?</a></h3>
<ul>
<li>Check the <a href="troubleshooting.html">troubleshooting guide</a>.</li>
<li>Check the <a href="https://github.com/cleolibrary/CLEO-Redux/issues">GitHub tickets</a></li>
<li>Check the <a href="https://github.com/cleolibrary/CLEO-Redux/wiki/Feature-Support-Matrix">Feature support page</a></li>
<li>Ask a question in <a href="https://discord.gg/d5dZSfgBZr">our Discord</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="other-features"><a class="header" href="#other-features">Other Features</a></h1>
<p>CLEO Redux puts focus on improving dev experience and make scripting process easier.</p>
<ul>
<li><a href="other-features.html#integration-with-visual-studio-code">Integration with Visual Studio Code</a></li>
<li><a href="other-features.html#scm-log">SCM Log</a></li>
<li><a href="other-features.html#hot-reload">Hot Reload</a></li>
<li><a href="other-features.html#main-menu-information">Main Menu Information</a></li>
</ul>
<h2 id="integration-with-visual-studio-code"><a class="header" href="#integration-with-visual-studio-code">Integration with Visual Studio Code</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/jqz8_lGnG4g" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>VS Code has excellent JavaScript support out of the box and is highly customizable. CLEO Redux generates typings for all supported commands that you can use when writing JavaScript in VS Code. Add the following line in your <code>*.js</code> script to get the full autocomplete support:</p>
<p>For <code>GTA III</code> or <code>re3</code>:</p>
<pre><code>/// &lt;reference path=&quot;./.config/gta3.d.ts&quot; /&gt;
</code></pre>
<p>For <code>Vice City</code> or <code>reVC</code></p>
<pre><code>/// &lt;reference path=&quot;./.config/vc.d.ts&quot; /&gt;
</code></pre>
<p>For <code>San Andreas</code></p>
<pre><code>/// &lt;reference path=&quot;./.config/sa.d.ts&quot; /&gt;
</code></pre>
<p>For <code>Unknown</code> host</p>
<pre><code>/// &lt;reference path=&quot;./.config/unknown.d.ts&quot; /&gt;
</code></pre>
<p>This line instructs VS Code where to look for the commands definitions for the autocomplete feature. The <code>path</code> can be relative to the script file or be absolute. Examples above assume JS files are located in the CLEO directory. <a href="https://www.typescriptlang.org/docs/handbook/triple-slash-directives.html#-reference-path-">Find out more information</a> on the official TypeScript portal.</p>
<blockquote>
<p>This line is not needed for TS scripts as VS Code automatically imports <code>*.d.ts</code> files with the help of <a href="./typescript.html#ts-config"><code>tsconfig.json</code></a> file in the CLEO directory.</p>
</blockquote>
<h2 id="scm-log"><a class="header" href="#scm-log">SCM Log</a></h2>
<p>CLEO Redux has built-in support for basic tracing of SCM instructions. To trace opcodes in all running CS scripts open up <a href="./config.html"><code>cleo.ini</code></a> and change <code>LogOpcodes</code> to 1. Note that it can greatly impact game performance due to frequent microdelays during writes to the log file. Use this option only for debugging purposes.</p>
<p>In JavaScript code use <code>CLEO.debug.trace(true)</code> to trace all commands. Use <code>CLEO.debug.trace(false)</code> to turn it off.</p>
<h2 id="hot-reload"><a class="header" href="#hot-reload">Hot Reload</a></h2>
<p>CLEO monitors active scripts and reloads them in game as they change</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/WanLojClqFw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Adding a new script file in the <a href="./cleo-directory.html">CLEO directory</a> or deleting one while the game is running starts or stops the script automatically</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/LAi2syrsxJg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Hot reload for CS scripts does not work when CLEO Redux runs alongside CLEO Library (e.g. in classic San Andreas).</p>
<h2 id="main-menu-information"><a class="header" href="#main-menu-information">Main Menu Information</a></h2>
<p><code>Frontend</code> plugin displays some extra information such as the CLEO version and the amount of active scripts in the main menu of GTA III, Vice City, and San Andreas. It also checks for available updates. If this information is not needed, delete <code>Frontend.cleo</code> file from the CLEO plugins directory.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-text-fxt"><a class="header" href="#custom-text-fxt">Custom Text (FXT)</a></h1>
<p>CLEO Redux supports custom text content without the need to edit game files.</p>
<ul>
<li><a href="using-fxt.html#static-fxt-files">Static FXT files</a></li>
<li><a href="using-fxt.html#fxtstore">FxtStore</a></li>
</ul>
<h2 id="static-fxt-files"><a class="header" href="#static-fxt-files">Static FXT files</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/ctsKy7WnY9o" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>CLEO Redux can load and serve static text content. Create a new file with the <code>.fxt</code> extension and put it in the <code>CLEO\CLEO_TEXT</code> <a href="./cleo-directory.html">folder</a>. The file name can be any valid name.</p>
<p>Each FXT file contains a list of the key-value entries in the following format:</p>
<pre><code>&lt;KEY1&gt; &lt;TEXT1&gt;
&lt;KEY2&gt; &lt;TEXT2&gt;
...
&lt;KEYN&gt; &lt;TEXTN&gt;
</code></pre>
<p>There should be a single space character between a key and a value. The key's maximum length is 7 characters. Try using unique keys that are unlikely to clash with other entries. The text length is unlimited, however each game may impose its own limitations.</p>
<p>CLEO loads FXT files on startup and merges their content in a single dictionary. It also monitors the files and reloads them if any change is made.</p>
<p>You can also download an editor for FXT files from the <a href="https://cleo.li/download.html">CLEO library website</a>.</p>
<p>To display the custom content in game, use the <code>Text</code> class. The key defined in the FXT file is usually the first argument to the <code>Text</code> class methods, e.g.</p>
<pre><code>Text.PrintHelp('KEY1') // displays &lt;TEXT1&gt;
</code></pre>
<p>You can find the commands available in each game in the Sanny Builder Library, e.g. <a href="https://library.sannybuilder.com/#/sa_unreal/classes/Text">for San Andreas: DE</a>.</p>
<blockquote>
<p>CLEO Redux only supports texts encoded in UTF-8. It means that any non-standard encoding (e.g. for Russian localization by 1C) most likely will not work.</p>
</blockquote>
<h2 id="fxtstore-1"><a class="header" href="#fxtstore-1">FxtStore</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/FLyYyrGz1Xg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>CLEO Redux provides an interface for manipulating custom text directly in JavaScript code. There is a static variable, named <code>FxtStore</code> with the following interface:</p>
<pre><code class="language-ts">declare interface FxtStore {
  /**
   * Inserts new text content in the script's fxt storage overwriting the previous content and shadowing static fxt with the same key
   * @param key GXT key that can be used in text commands (7 characters max)
   * @param value text content
   * @param [isGlobal] if true, the text affects global FXT storage
   */
  insert(key: string, value: string, isGlobal?: boolean): void;
  /**
   * Removes the text content associated with the key in the local fxt storage
   * @param key GXT key
   * @param [isGlobal] if true, the text affects global FXT storage
   */
  delete(key: string, isGlobal?: boolean): void;
}
</code></pre>
<p>Using <code>FxtStore</code> you can create unique keys and values in the script and put it in local FXT storage. Each script owns a private storage and keys from one script will not conflict with other scripts. Also keys defined in the FxtStore shadow the same keys defined in static FXT files. Consider the example:</p>
<p>custom.fxt:</p>
<pre><code>MY_KEY Text from FXT file
</code></pre>
<p>custom.js:</p>
<pre><code class="language-js">Text.PrintHelp(&quot;MY_KEY&quot;); // this displays &quot;Text from FXT file&quot;
FxtStore.insert(&quot;MY_KEY&quot;, &quot;Text from script&quot;);
Text.PrintHelp(&quot;MY_KEY&quot;); // this displays &quot;Text from script&quot;
FxtStore.delete(&quot;MY_KEY&quot;);
Text.PrintHelp(&quot;MY_KEY&quot;); // this displays &quot;Text from FXT file&quot; again
</code></pre>
<blockquote>
<p>The private FXT storage is not supported in The Trilogy, Bully and GTA IV. Each script there modifies the global FXT storage. This behavior may change in the future.</p>
</blockquote>
<p><code>insert</code> and <code>delete</code> methods can be forced to change global FXT keys even when the current host supports a private storage. By setting the last argument <code>isGlobal</code> to <code>true</code> you can mutate (add or delete) keys in the global storage. It might be helpful to deal with those keys that the game uses after procesing all scripts in a given frame (e.g. in delayed messages or HUD elements text) when the script's private storage is not available.</p>
<p>Custom text can be constructed dynamically, e.g.:</p>
<pre><code class="language-js">while (true) {
  wait(0);
  FxtStore.insert(&quot;TIME&quot;, &quot;Timestamp: &quot; + Date.now());
  Text.PrintHelp(&quot;TIME&quot;); // this displays &quot;Timestamp: &quot; and the updated timestamp value
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="unsupported-or-limited-support-scenarios"><a class="header" href="#unsupported-or-limited-support-scenarios">Unsupported or limited support scenarios</a></h1>
<p>Despite our best effort some scenarios while available in game are not supported or supported with limitations by CLEO Redux. Some of them are imposed by the nature of SCM format or JavaScript language or the difficulties in bridging JavaScript and the native code.</p>
<p>Check the <a href="https://github.com/cleolibrary/CLEO-Redux/wiki/Feature-Support-Matrix">Features support page</a> to find out high-level features and the status of their support in different games.</p>
<p>The following items are known to be not working and there is no specific timeline on getting them fixed.</p>
<h2 id="unsupported-features-in-cs"><a class="header" href="#unsupported-features-in-cs">Unsupported features in CS</a></h2>
<ul>
<li>in x64 games (SA: DE) you can't read and write 64-bit values as the script engine only supports 32-bit values. You may need to use other means to access the game memory (e.g. from JavaScript)</li>
</ul>
<h2 id="unsupported-features-in-js"><a class="header" href="#unsupported-features-in-js">Unsupported features in JS</a></h2>
<ul>
<li>
<p>for commands requiring a global SCM variable (e.g. countdown timers) use <a href="https://github.com/x87/scm.ts">scm.ts library</a>.</p>
</li>
<li>
<p>commands implicitly loading models or textures (such as widgets) <a href="https://github.com/cleolibrary/CLEO-Redux/issues/12">Tracking issue</a>. You can circumvent the issue by preloading needed resources, e.g. by calling them in a .CS script first.</p>
</li>
<li>
<p>you can't call the game functions that need references to variables to store the result. There is no &quot;take an address of the variable&quot; syntax. As a workaround, if the platform permits (e.g. in San Andreas with CLEO 4.4) you can allocate a memory block and pass its address to the function, then read the result from the memory using <a href="./using-memory.html">Memory.Read</a>.</p>
</li>
<li>
<p>only integer numbers can be used as arguments for commands with variable arguments, such as <code>Text.PrintFormattedNow</code>. In the Sanny Builder Library these arguments are referred to as <code>arg: arguments</code>. If you need to pass a floating-point value, you can use <code>Memory.FromFloat</code>:</p>
</li>
</ul>
<pre><code>Text.PrintFormattedNow('%d %d %d %.2f', 100, 1, 2, 3, Memory.FromFloat(1.5))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="embedding-to-custom-host"><a class="header" href="#embedding-to-custom-host">Embedding to custom host</a></h1>
<p>CLEO Redux can be embedded and run JS scripts on an unknown (i.e. not <a href="./introduction.html#supported-releases">supported officially</a>) host. A <em>host</em> is an application in which process <code>cleo_redux.asi</code> or <code>cleo_redux64.asi</code> <a href="embedding.html#loading-into-custom-process">gets loaded or injected</a> and where the CLEO runtime <a href="embedding.html#launching-the-cleo-runtime">runs</a>. This feature is highly experimental and subject to change at any moment.</p>
<ul>
<li><a href="embedding.html#loading-into-custom-process">Loading into custom process</a></li>
<li><a href="embedding.html#launching-the-cleo-runtime">Launching the CLEO runtime</a>
<ul>
<li><a href="embedding.html#automatic-launch">Automatic launch</a></li>
<li><a href="embedding.html#manually-controlling-the-runtime">Manually Controlling the Runtime</a></li>
</ul>
</li>
<li><a href="embedding.html#available-commands">Available Commands</a></li>
<li><a href="embedding.html#manifest">Manifest</a>
<ul>
<li><a href="embedding.html#example">Example</a></li>
</ul>
</li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/rk2LvDt7UkI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="loading-into-custom-process"><a class="header" href="#loading-into-custom-process">Loading into custom process</a></h2>
<p>There are multiple ways of loading ASI file into the target process. They include but not limited to <a href="https://github.com/ThirteenAG/Ultimate-ASI-Loader/releases">Ultimate ASI Loader</a> or any <a href="https://github.com/search?q=dll+injector">DLL injector</a> available on GitHub. The host can load CLEO ASI file as a dynamic library when needed using WinAPI's <code>LoadLibrary</code> function.</p>
<h2 id="launching-the-cleo-runtime"><a class="header" href="#launching-the-cleo-runtime">Launching the CLEO runtime</a></h2>
<p>After injecting CLEO into the target process you should launch the runtime to execute scripts. There are two ways of doing it: automatic and manual.</p>
<h3 id="automatic-launch"><a class="header" href="#automatic-launch">Automatic launch</a></h3>
<p>To launch the runtime on an unknown host immediately after loading, open the <a href="./config.html">config file</a> and set <code>EnableSelfHost</code> to <code>1</code>. When loaded as a self host CLEO Redux scans the <a href="./cleo-directory.html">CLEO directory</a> for plugins and scripts and runs them. This option is suitable if you don't have control over the host's source code and inject the library using an injector.</p>
<h3 id="manually-controlling-the-runtime"><a class="header" href="#manually-controlling-the-runtime">Manually Controlling the Runtime</a></h3>
<p>The host can start the runtime and advance its main loop using SDK methods <code>RuntimeInit</code> and <code>RuntimeNextTick</code>. This option is suitable if you have control over the host's source code and can execute arbitrary instructions.</p>
<p>This is how it can be implemented in Rust:</p>
<pre><code class="language-toml">[dependencies]
ctor = &quot;0.1.21&quot;
cleo_redux_sdk = &quot;^0.0.6&quot;
</code></pre>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use ctor::*;

#[cfg_attr(target_arch = &quot;x86&quot;, link(name = &quot;cleo_redux&quot;))]
#[cfg_attr(target_arch = &quot;x86_64&quot;, link(name = &quot;cleo_redux64&quot;))]

#[ctor]
fn init() {
    use cleo_redux_sdk;
    use std::{thread, time};

    // load CLEO scripts, FXT, enable file watcher
    cleo_redux_sdk::runtime_init();

    // init time variables
    const FPS: i32 = 30;
    let time_step = 1000 / FPS;
    let started = time::Instant::now();

    thread::spawn(move || loop {
        let current_time = started.elapsed().as_millis() as u32;

        // advance main loop providing current time and time step
        // current time is used to determine whether a script should &quot;wake up&quot; after wait command
        // time step is used to increment TIMERA and TIMERB variables
        cleo_redux_sdk::runtime_next_tick(current_time, time_step);

        // pause for at least time step ms
        thread::sleep(time::Duration::from_millis(time_step as u64));
    });
}
<span class="boring">}
</span></code></pre></pre>
<h2 id="available-commands"><a class="header" href="#available-commands">Available Commands</a></h2>
<p>In the self-hosted mode CLEO Redux supports <a href="./api.html#cleo-redux-bindings">own bindings</a> and commands made with <a href="./using-sdk.html">SDK</a>. It uses command definitions for the Unknown host from Sanny Builder Library (available for <a href="https://library.sannybuilder.com/#/unknown_x86">32-bit</a> and <a href="https://library.sannybuilder.com/#/unknown_x64">64-bit</a>).</p>
<p>You can use all standard JavaScript features. The list of available commands can be seen in the auto-generated file <code>.config/unknown.d.ts</code>.</p>
<h2 id="manifest"><a class="header" href="#manifest">Manifest</a></h2>
<p>Manifest is a file with static configuration for the given host. Only unknown hosts make use of it. The configuration should be stored in <code>.config\manifest.json</code> with the following structure:</p>
<pre><code class="language-json">{
    &quot;host&quot;: string,
    &quot;host_name&quot;: string,
    &quot;compound&quot;: boolean
}
</code></pre>
<ul>
<li>
<p><code>host</code> should match the host's executable name. E.g. if the host runs via <code>application.exe</code>, the value is <code>application</code>. Available in scripts as the <a href="./api.html#host">HOST variable</a>.</p>
</li>
<li>
<p><code>host_name</code> defines the host's custom name used in the <a href="./log.html">log</a></p>
</li>
<li>
<p><code>compound</code> defines whether the host uses <a href="./definitions.html">compound definitions</a>. By default the host uses definitions from the file matching <code>&lt;host&gt;.json</code>, e.g. <code>application.json</code>. This file should be provided by the person managing integration of CLEO Redux with the given host and placed in the <code>.config</code> folder.</p>
<p>When <code>compound</code> is set to <code>true</code> the host also uses command definitions for the Unknown host (e.g. <code>unknown_x86.json</code>). If this file is missing CLEO downloads it from Sanny Builder Library.</p>
</li>
</ul>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>Host: <a href="https://sannybuilder.com">Sanny Builder 3</a> (<code>sanny.exe</code>)</p>
<pre><code class="language-json">{
  &quot;host&quot;: &quot;sanny&quot;,
  &quot;host_name&quot;: &quot;Sanny Builder 3&quot;,
  &quot;compound&quot;: true
}
</code></pre>
<p><code>Sanny Builder 3\CLEO\.config</code> folder contains <code>sanny.json</code> and <code>manifest.json</code> before the first run. The other files are downloaded or generated automatically.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cleo-redux-sdk"><a class="header" href="#cleo-redux-sdk">CLEO Redux SDK</a></h1>
<p>SDK provides a way to create new script commands for any game that CLEO Redux supports. It is agnostic to the game title and the underlying runtime (CS or JS). At this moment CLEO provides <a href="https://github.com/cleolibrary/CLEO-Redux/tree/master/SDK">SDK for the C++ and Rust languages</a>.</p>
<ul>
<li><a href="using-sdk.html#sdk-version">SDK Version</a></li>
<li><a href="using-sdk.html#platforms-support">Platforms Support</a></li>
<li><a href="using-sdk.html#plugin-lifetime">Plugin Lifetime</a></li>
<li><a href="using-sdk.html#path-resolution-convention">Path Resolution Convention</a></li>
<li><a href="using-sdk.html#string-arguments">String Arguments</a></li>
<li><a href="using-sdk.html#developing-new-commands">Developing New Commands</a>
<ul>
<li><a href="using-sdk.html#unsafe-commands">Unsafe commands</a></li>
<li><a href="using-sdk.html#command-interface">Command interface</a>
<ul>
<li><a href="using-sdk.html#claiming-opcodes">Claiming Opcodes</a></li>
<li><a href="using-sdk.html#why-use-command-names-and-not-an-id-for-the-command-lookup">Why use command names and not an id for the command lookup?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="using-sdk.html#developing-file-loaders">Developing File Loaders</a></li>
</ul>
<h2 id="sdk-version"><a class="header" href="#sdk-version">SDK Version</a></h2>
<p>The current version is <code>6</code>. Changes to SDK advance this number by one.</p>
<h2 id="platforms-support"><a class="header" href="#platforms-support">Platforms Support</a></h2>
<p>CLEO Redux provides SDK for both 32-bit and 64-bit games. There is one notable change between the two: on the 32-bit platform the SDK functions <code>GetIntParam</code> and <code>SetIntParam</code> operate on signed 32-bit numbers, whereas on the 64-bit platform they operate on signed 64-bit numbers (declared as the type <code>isize</code>).</p>
<p>It's recommended for 64-bit plugins to have <code>64</code> in their names (e.g. <code>myplugin64.cleo</code>).</p>
<h2 id="plugin-lifetime"><a class="header" href="#plugin-lifetime">Plugin Lifetime</a></h2>
<p>Each plugin is a dynamic-link library (DLL) with the <code>.cleo</code> extension that must be placed in <code>CLEO\CLEO_PLUGINS</code>. CLEO Redux scans this directory on startup and loads all <code>.cleo</code> files using WinAPI's function <code>LoadLibrary</code>.</p>
<h2 id="path-resolution-convention"><a class="header" href="#path-resolution-convention">Path Resolution Convention</a></h2>
<p>String arguments representing a path to the directory or file must be normalized using SDK's function <code>ResolvePath</code>. This function takes a path and returns the absolute path resolved according to the following rules:</p>
<ul>
<li>
<p>an absolute path gets resolved as is</p>
</li>
<li>
<p>a path starting with <code>CLEO/</code> or <code>CLEO\\</code> gets resolved relative to the <a href="./cleo-directory.html">CLEO directory</a> which is either</p>
<ul>
<li><code>{game}\CLEO</code> or</li>
<li><code>{user}\AppData\Roaming\CLEO Redux\CLEO</code></li>
</ul>
</li>
<li>
<p>a path starting with <code>./</code> or <code>../</code> gets resolved relative to the script directory.</p>
<p>What is <strong>the script directory</strong>?</p>
<p>For CS scripts it is always the CLEO directory.</p>
<p>For JS scripts it could be the CLEO directory (if the JS file is located there). Or if the script is <a href="./script-lifecycle.html#organizing-scripts">located in a subfolder</a> inside the CLEO directory, then the script directory is the one that contains its <code>index.js</code> file.</p>
<p>It is different from the resolution algorithm <a href="./imports.html#importing-scripts">used by the <code>import</code> statement</a>. The <code>import</code> statement resolves paths relative to the current file's directory (that can be nested many levels deep), whereas the <code>ResolvePath</code> does not go deeper than the <code>index.js</code> directory. You can use the <a href="./api.html#__dirname"><code>__dirname</code></a> variable to get the directory of the current file:</p>
<pre><code class="language-js">DynamicLibrary.Load(__dirname + &quot;\\mylib.dll&quot;);
</code></pre>
<p>See <a href="https://github.com/cleolibrary/CLEO-Redux/issues/77">https://github.com/cleolibrary/CLEO-Redux/issues/77</a></p>
</li>
<li>
<p>all other paths get resolved relative to the current working directory (the game directory)</p>
</li>
</ul>
<h2 id="string-arguments"><a class="header" href="#string-arguments">String Arguments</a></h2>
<p>Strings passed in and out of the SDK methods are UTF-8 encoded.</p>
<p>If the script uses an integer value where a string is expected SDK treats this number as a pointer to a null-terminated UTF-8 character sequence to read, or to a large enough buffer to store the result to:</p>
<pre><code class="language-js">IniFile.WriteString(0xdeadbeef, &quot;my.ini&quot;, &quot;section&quot;, &quot;key&quot;);
</code></pre>
<p>SDK will read a string from the address <code>0xDEADBEEF</code> and write it to the ini file.</p>
<pre><code>0AF4: read_string_from_ini_file 'my.ini' section 'section' key 'key' store_to 0xDEADBEEF
</code></pre>
<p>SDK will read a string from the ini file and write it at the address <code>0xDEADBEEF</code>.</p>
<h2 id="developing-new-commands"><a class="header" href="#developing-new-commands">Developing New Commands</a></h2>
<p>To register custom command handlers the plugin must call <code>RegisterCommand</code> in the DllMain function. Once a user script encounters this command CLEO Redux invokes the handler with the one argument which is a pointer to the current context. This pointer must be used for calling other SDK methods. See <a href="./cpp-sdk.html">C++ SDK</a> guide or <a href="./rust-sdk.html">Rust SDK</a> guide for examples.</p>
<h3 id="unsafe-commands"><a class="header" href="#unsafe-commands">Unsafe commands</a></h3>
<p>New commands that use low-level WinAPI and can potentially damage user environment must be explicitly registered with a permission token (third argument to the <code>RegisterCommand</code>). User can disallow usage of unsafe commands in the scripts using <a href="./permissions.html">permission config</a>. At the moment three permission tokens are used: <code>mem</code>, <code>fs</code>, and <code>dll</code>. They mark commands operating with the host process, user files and external libraries.</p>
<h3 id="command-interface"><a class="header" href="#command-interface">Command interface</a></h3>
<p>CLEO Redux uses <a href="https://library.sannybuilder.com">Sanny Builder Library</a> to know an interface of any command. For a new command to become available in the scripts, the JSON file (<code>gta3.json</code>, <code>vc.json</code>, <code>sa.json</code>) must have the command definition, including the name that matches with the value that the plugin uses <code>RegisterCommand</code> with. E.g. if the plugin registers <code>SHOW_MESSAGE</code> command, the JSON file must have a command with the <code>name</code> property set to <code>SHOW_MESSAGE</code>. The number and order of the input and output parameters in the definition must match the order of methods used by the plugin (i.e. <code>GetXXXParam</code> for each input argument and <code>SetXXXParam</code> for each output argument).</p>
<h4 id="claiming-opcodes"><a class="header" href="#claiming-opcodes">Claiming Opcodes</a></h4>
<p>Opcodes get assigned to new commands in Sanny Builder Library based on the availability, similarity with existing commands in other games, and other factors. To claim an opcode reach out to Sanny Builder Library maintainers <a href="https://github.com/sannybuilder/library/issues">on GitHub</a>.</p>
<h4 id="why-use-command-names-and-not-an-id-for-the-command-lookup"><a class="header" href="#why-use-command-names-and-not-an-id-for-the-command-lookup">Why use command names and not an id for the command lookup?</a></h4>
<p>One of the common issues with CLEO Library plugins was that commands authored by different people often had id collisions. If two plugins add commands with the same id, it is impossible to use them both. Using string names minimizes the collisions with custom plugins as well as with native opcodes. The library's definitions ensure each command claims only an available id. Also it helps to track and document plugins in a single place.</p>
<h2 id="developing-file-loaders"><a class="header" href="#developing-file-loaders">Developing File Loaders</a></h2>
<p>A plugin can associate itself with a particular <a href="https://en.wikipedia.org/wiki/Glob_(programming)">glob pattern</a> (or in other word a file name with wildcard characters in it, e.g. <code>*.txt</code>) and provide a handler to be called when a script <a href="./imports.html">imports</a> a file matching the pattern.</p>
<p>The glob pattern can be used to match an arbitrary file name using wildcards to represent any characters (<code>*.pak*</code> would match <code>1.pak1</code>, <code>2.pak1</code>, <code>3.pak3</code>, etc) or a specific file name (<code>gta.dat</code> would match only a <code>gta.dat</code> file). Be mindful about using wildcards to avoid matching unnecessary files. The plugin can associate itself with many globs (for example TextLoader uses <code>*.txt</code> and <code>*.text</code>), but it's recommended to support only related formats in one plugin.</p>
<p>The handler gets a full path to the file as an input and returns a pointer to the buffer with the content of the file that has been serialized into JSON. The serialized JSON content should be a valid null-terminated UTF-8 string.</p>
<blockquote>
<p>To allocate a memory buffer for the serialized string the plugin MUST call SDK's method <code>AllocMem</code>. This memory will be released by CLEO Redux once it reads the data from it. Allocating the memory inside the plugin will lead to an error.</p>
</blockquote>
<p>If the serialization has failed or the file does not have the expected format (for example due to a glob matching too many files), the handler should return a null pointer. In this case CLEO proceeds to another loader that could handle this file.</p>
<p><a href="https://github.com/cleolibrary/CLEO-Redux/tree/master/loaders">See examples</a> of the file loaders implemented for Text files (in C++) and IDE files (in Rust).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="c-sdk"><a class="header" href="#c-sdk">C++ SDK</a></h1>
<p>This page describes basic steps needed to create a new custom command with C++ SDK that reads two integer arguments and returns their sum. 
This guide has been tested on Visual Studio 2019 and Visual Studio 2022 (Community Edition) and may differ for other IDEs and compilers.</p>
<h2 id="developing-a-plugin"><a class="header" href="#developing-a-plugin">Developing a Plugin</a></h2>
<ul>
<li>
<p>Create a new Dynamic-link Library (DLL) project. In <code>Project Settings-&gt;Advanced</code> set <code>Target File Extension</code> to <code>.cleo</code>.</p>
</li>
<li>
<p>Download <a href="https://raw.githubusercontent.com/cleolibrary/CLEO-Redux/master/SDK/cleo_redux_sdk.h"><code>cleo_redux_sdk.h</code></a> and add it in your project</p>
</li>
</ul>
<pre><code class="language-cpp">#include &quot;cleo_redux_sdk.h&quot;
</code></pre>
<p>If this header file is located outside of your project directory you need to add a folder with this file in <code>Project Settings-&gt;VC++ Directories-&gt;Include Directories</code> to let Visual Studio discover this file.</p>
<ul>
<li>
<p>In <code>Project Settings-&gt;Linker-&gt;Input</code> add the full path to <a href="https://github.com/cleolibrary/CLEO-Redux/blob/master/SDK/cleo_redux.lib?raw=true"><code>cleo_redux.lib</code></a> (if you develop a 32-bit plugin) or to <a href="https://github.com/cleolibrary/CLEO-Redux/blob/master/SDK/cleo_redux64.lib?raw=true"><code>cleo_redux64.lib</code></a> for 64-bit plugins.</p>
</li>
<li>
<p>in <code>dllmain.cpp</code> create a new static class with the constructor function. This constructor will be called as soon as CLEO loads your plugin</p>
</li>
</ul>
<pre><code class="language-cpp">class TestPlugin {
public:
	TestPlugin() {
		Log(&quot;My Test Plugin&quot;);
	}
} TestPlugin;
</code></pre>
<ul>
<li>in the plugin class constructor call <code>RegisterCommand</code> function for each new command</li>
</ul>
<pre><code class="language-cpp">class TestPlugin {
public:
	TestPlugin() {
		Log(&quot;My Test Plugin&quot;);
        RegisterCommand(&quot;INT_ADD&quot;, IntAdd);
	}

    static HandlerResult IntAdd(Context ctx) {
        return HandlerResult::CONTINUE;
    }
} TestPlugin;
</code></pre>
<ul>
<li>implement handlers for new commands. Each command handler gets one input argument which is <code>Context ctx</code>. This argument is used to call other SDK methods</li>
</ul>
<pre><code class="language-cpp">class TestPlugin {
public:
	TestPlugin() {
		Log(&quot;My Test Plugin&quot;);
        RegisterCommand(&quot;INT_ADD&quot;, IntAdd);
	}

    static HandlerResult IntAdd(Context ctx) {
        auto arg1 = GetIntParam(ctx);
        auto arg2 = GetIntParam(ctx);
        SetIntParam(ctx, arg1 + arg2);

        return HandlerResult::CONTINUE;
    }
} TestPlugin;
</code></pre>
<ul>
<li>
<p>compile the project and place <code>.cleo</code> file to the <a href="./installation-plugins.html"><code>CLEO_PLUGINS</code></a> folder.</p>
</li>
<li>
<p>add command definition in the JSON file for the target game (e.g. <code>gta3.json</code> for GTA III or <code>unknown_x86.json</code> for an Unknown (x86) host). Each <code>GetXXXParam</code>/<code>SetXXXParam</code> should be paired with an input or output in the command definition</p>
</li>
</ul>
<pre><code class="language-json">{
    &quot;input&quot;: [
        { &quot;name&quot;: &quot;arg1&quot;, &quot;type&quot;: &quot;int&quot; },
        { &quot;name&quot;: &quot;arg2&quot;, &quot;type&quot;: &quot;int&quot; }
    ],
    &quot;output&quot;: [
        { &quot;name&quot;: &quot;result&quot;, &quot;type&quot;: &quot;int&quot;, &quot;source&quot;: &quot;var_any&quot; }
    ],
    &quot;id&quot;: &quot;0DDD&quot;,
    &quot;name&quot;: &quot;INT_ADD&quot;,
    &quot;num_params&quot;: 3,
    &quot;short_desc&quot;: &quot;Adds together two integer values and writes the result into the variable&quot;,
},
</code></pre>
<p><code>id</code> is optional for unknown hosts. For known and supported games an id must be a unique opcode not used elsewhere.</p>
<p>The best way to generate correct command definition is to use <a href="https://library.sannybuilder.com/">Sanny Builder Library</a>. If you plan to share the plugin and make it available over the Internet consider contacting the library maintainers to get your command published there.</p>
<ul>
<li>you can now use the new command in the code using the <a href="./api.html#native"><code>native</code></a> command</li>
</ul>
<pre><code class="language-js">var result = native(&quot;INT_ADD&quot;, 10, 20); // 30
</code></pre>
<h2 id="example-1"><a class="header" href="#example-1">Example</a></h2>
<p>See the <a href="https://library.sannybuilder.com/#/sa_unreal/classes/IniFile"><code>IniFiles</code></a> plugin that includes a complete project for Visual Studio 2019.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-sdk"><a class="header" href="#rust-sdk">Rust SDK</a></h1>
<p>Rust SDK uses similar to C++ interface with some extra wrapping methods to allow easily convert between C and Rust types. The header file is available as a <a href="https://crates.io/crates/cleo_redux_sdk">crate</a> on crates.io. See the documentation <a href="https://docs.rs/cleo_redux_sdk/latest/">here</a>.</p>
<h2 id="example-2"><a class="header" href="#example-2">Example</a></h2>
<p>See the <code>Input</code> plugin. It adds a bunch of new commands to check or emulate keyboard and mouse input. 
https://github.com/cleolibrary/CLEO-Redux/tree/master/plugins/Input</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
